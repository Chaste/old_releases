<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <title>ChasteGuides/CodeGenerationFromCellML - Chaste</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="https://chaste.github.io/old_releases/trac.css" type="text/css" />
    <link rel="stylesheet" href="https://chaste.github.io/old_releases/wiki.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="https://chaste.github.io/old_releases/site.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <p>
          <a id="logo" href="https://chaste.github.io/"><img src="https://chaste.github.io/chaste_0256.png" alt="Chaste logo" height="60" /></a>
          <em>Documentation for <a href="https://chaste.github.io/old_releases/release_2021.1/">Release 2021.1</a>.</em>
        </p>
      </div>
    </div>
    <p>&nbsp;</p>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          <div id="wikipage" class="trac-content"><h1 id="UsingCellMLelectrophysiologymodelsinCardiacChaste">Using CellML electrophysiology models in Cardiac Chaste</h1>
<p>
</p><div class="wiki-toc">
<ol>
  <li>
    <a href="#UsingCellMLelectrophysiologymodelsinCardiacChaste">Using CellML electrophysiology models in Cardiac Chaste</a>
    <ol>
      <li>
        <a href="#UsingCellMLfilesassourcesdirectlyinChaste">Using CellML files as sources directly in Chaste</a>
        <ol>
          <li>
            <a href="#Project-specificconversionoptions">Project-specific conversion options</a>
          </li>
          <li>
            <a href="#Model-specificconversionoptions">Model-specific conversion options</a>
          </li>
          <li>
            <a href="#Dynamicloading">Dynamic loading</a>
          </li>
          <li>
            <a href="#UsingdynamicallyloadedCellMLmodelsinChastetestsorprojects">Using dynamically loaded CellML models in Chaste tests or projects</a>
          </li>
        </ol>
      </li>
      <li>
        <a href="#ModelannotationwithRDF">Model annotation with RDF</a>
        <ol>
          <li>
            <a href="#Standardisednames">Standardised names</a>
          </li>
          <li>
            <a href="#chaste_codegenconversionspecificparameters">chaste_codegen conversion specific parameters</a>
            <ol>
              <li>
                <a href="#Modifiableparameters">Modifiable parameters</a>
              </li>
              <li>
                <a href="#Derivedquantities">Derived quantities</a>
              </li>
              <li>
                <a href="#Variablerangechecking">Variable range checking</a>
              </li>
              <li>
                <a href="#Self-excitatorymodels">Self-excitatory models</a>
              </li>
              <li>
                <a href="#Namedattributes">Named attributes</a>
              </li>
            </ol>
          </li>
          <li>
            <a href="#Combiningannotations">Combining annotations</a>
          </li>
        </ol>
      </li>
      <li>
        <a href="#chaste_codegencommandlinearguments">chaste_codegen command line arguments</a>
        <ol>
          <li>
            <a href="#activation">activation</a>
          </li>
          <li>
            <a href="#commandlinearguments">command line arguments</a>
          </li>
          <li>
            <a href="#Thecellmlfile">The cellml file</a>
          </li>
          <li>
            <a href="#Modeltypes">Model types</a>
            <ol>
              <li>
                <a href="#GeneratinganormalmodelorstandardAbstractCardiacCellsubclass.">Generating a normal model, or standard <tt>AbstractCardiacCell</tt> subclass.</a>
              </li>
              <li>
                <a href="#GenerateCVODEcellsAbstractCvodeCellsubclass.">Generate CVODE cells, <tt>AbstractCvodeCell</tt> subclass.</a>
              </li>
              <li>
                <a href="#GenerateCVODEcellswithdataclamp">Generate CVODE cells with data clamp</a>
              </li>
              <li>
                <a href="#GeneratingBackwardEulercellsAbstractBackwardEulerCardiacCellsubclass.">Generating Backward Euler cells, <tt>AbstractBackwardEulerCardiacCell</tt> &hellip;</a>
              </li>
              <li>
                <a href="#GeneratingRushLarsencellsAbstractRushLarsenCardiacCellsubclass.">Generating Rush Larsen cells, <tt>AbstractRushLarsenCardiacCell</tt> subclass.</a>
              </li>
              <li>
                <a href="#GeneratingGeneralizedRushLarsencellsAbstractGeneralizedRushLarsenCardiacCellsubclass.">Generating Generalized Rush Larsen cells, &hellip;</a>
              </li>
            </ol>
          </li>
          <li>
            <a href="#Chasteoptions">Chaste options</a>
          </li>
          <li>
            <a href="#Generatedcodeoptions">Generated code options</a>
          </li>
        </ol>
      </li>
      <li>
        <a href="#UseofCellMLinthecardiacexecutable">Use of CellML in the cardiac executable</a>
      </li>
      <li>
        <a href="#Installingchaste_codegen">Installing chaste_codegen</a>
      </li>
      <li>
        <a href="#TroubleShooting">TroubleShooting</a>
      </li>
      <li>
        <a href="#SummaryofchangescomparedtoPyCml">Summary of changes compared to PyCml</a>
      </li>
    </ol>
  </li>
</ol>
</div><p>
<strong>Please note: This is the guide for chaste_codegen the Python3 code generator.</strong> For the Python2 version (PyCml) used up to release 2019.1 see the <a href="https://chaste.cs.ox.ac.uk/chaste/tutorials/release_2019.1/ChasteGuides/CodeGenerationFromCellML.html">release 2019.1 version of this guide</a>.
</p>
<p>
<strong>Please note:</strong> experienced Chaste users may want to skip to the <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#SummaryofchangescomparedtoPyCml">Summary of changes compared to PyCml</a>
</p>
<p>
This page contains some notes on generating Chaste code for cardiac cell models from CellML files, using <a class="ext-link" href="https://github.com/ModellingWebLab/chaste-codegen"><span class="icon">​</span>chaste_codegen</a>, the Python3 Chaste CellML toolkit. <a class="ext-link" href="https://github.com/ModellingWebLab/chaste-codegen"><span class="icon">​</span>chaste_codegen</a> is developed in Python3 and distributed via <a class="ext-link" href="https://pypi.org/project/chaste-codegen/"><span class="icon">​</span>The Python Package Index (PyPI)</a>. The chaste build process automatically creates a Python3 virtual environment and installes chaste_codegen in this for generating code from cellml files.
</p>
<p>
The process is mostly automatic, although some of the options require some human intervention, and the CellML file itself may need to be <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#ModelannotationwithRDF">annotated</a> in order to allow successful conversion (for example, to indicate which variables represent the transmembrane potential and stimulus current).  Many annotated CellML files may be found in the Chaste repository, either in the <a class="source" href="/trac/browser/trunk/heart/src/odes/cellml">heart/src/odes/cellml</a> folder, or the <a class="ext-link" href="https://github.com/Chaste/cellml"><span class="icon">​</span>cellml project</a>.
</p>
<p>
There are two main ways of using CellML within Chaste.  If you are a cardiac executable user, then providing you compiled the executable from source yourself, CellML files may be loaded on the fly, as <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#UseofCellMLinthecardiacexecutable">described below</a>.  If however you are using the source release of Chaste directly, the sections on <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#UsingdynamicallyloadedCellMLmodelsinChastetestsorprojects">using dynamically loaded CellML models</a> and <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#UsingCellMLfilesassourcesdirectlyinChaste">using CellML files as sources in Chaste</a> will be relevant.
</p>
<h2 id="UsingCellMLfilesassourcesdirectlyinChaste">Using CellML files as sources directly in Chaste</h2>
<p>
The Chaste build system uses chaste_codegen to generate source code from CellML files 'on the fly'.  CellML files located within <tt>src</tt> or <tt>test</tt> folders will generate code that can be used like normal C++ classes. 
It can be very helpful to have access to a range of models, by using the <a class="ext-link" href="https://github.com/Chaste/cellml"><span class="icon">​</span>Chaste cellml project</a>. This project contains many of the common models, pre-annotated with metadata for automatic conversion, and tagging of many of the common parameters you may wish to vary/investigate. See the README.txt at the previous link for instructions on including this project within your own project.
</p>
<p>
<strong>Please note:</strong> unlike its predecessor chaste_codegen calculates its own analytic jacobians and does not use .out files.  
</p>
<h3 id="Project-specificconversionoptions">Project-specific conversion options</h3>
<p>
You can also provide project-wide arguments for conversion of any cellml files within that project. For example, to generate cell models that use modifiers for metadata-annotated variables:
</p>
<p>
<strong>1. New  build system (CMake)</strong>
</p>
<p>
Add the following line to your project's CMakeLists.txt
</p>
<pre class="wiki"># Here we add extra arguments to force chaste_codegen to use this extra argument (make Get and Set methods for
# all metadata annotated variables). 
set(Chaste_CODEGEN_EXTRA_ARGS "--use-modifiers")
</pre><p>
<strong>2. Old build system (Scons)</strong>
</p>
<p>
Add flag to your project's  SConscript file:
</p>
<pre class="wiki"># Change some flags just for this project 
env = SConsTools.CloneEnv(env) 
env['CODEGEN_EXTRA_ARGS'] = ['--use-modifiers'] 
</pre><p>
before the <tt>DoProjectSConscript()</tt> call.
</p>
<h3 id="Model-specificconversionoptions">Model-specific conversion options</h3>
<p>
<strong>Please note:</strong> Unlike its predecessor chaste_codegen does not make use of config files, instead chaste_codegen uses <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#chaste_codegencommandlinearguments">chaste_codegen command line arguments</a>. In order to specify conversion options, which are different from the default or project-specific options, please make use of dynamic loading (see <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#UsingdynamicallyloadedCellMLmodelsinChastetestsorprojects">using dynamically loaded CellML models</a>).
</p>
<h3 id="Dynamicloading">Dynamic loading</h3>
<p>
If the CellML file is placed within a <tt>dynamic</tt> folder (e.g. <a class="source" href="/trac/browser/trunk/heart/dynamic">source:trunk/heart/dynamic</a>), however, it will be compiled to a shared library suitable for loading dynamically by the executable.  In this case, only a single output variant (.hpp &amp; .cpp pair) can be generated, so by default normal cells will be generated (see <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#commandlinearguments">command line arguments</a>). If other types are required, edit <tt>CODEGEN_EXTRA_ARGS</tt> (see <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#Project-specificconversionoptions">Project-specific conversion options</a>).
</p>
<p>
See the CellML files in <a class="source" href="/trac/browser/trunk/heart/src/odes/cellml">source:trunk/heart/src/odes/cellml</a> for examples.
</p>
<h3 id="UsingdynamicallyloadedCellMLmodelsinChastetestsorprojects">Using dynamically loaded CellML models in Chaste tests or projects</h3>
<p>
Your own code built on Chaste may also use dynamically compiled and loaded CellML models. There is now a helper class ​<a class="ext-link" href="https://chaste.cs.ox.ac.uk/chaste/docs/release_2021.1/classCellMLLoader.html" title="Documentation for the CellMLLoader class"><span class="icon">​</span>CellMLLoader</a>  for this. An example is given below:
</p>
<pre class="wiki">#include "CellMLToSharedLibraryConverter.hpp"
#include "AbstractCvodeCell.hpp"
...
// create a stimulus and solver for creating a cardiac cell
double magnitude = -25.5;
double duration  = 2.0 ;  // ms
double when = 50.0; // ms
boost::shared_ptr&lt;SimpleStimulus&gt; p_stimulus(new SimpleStimulus(magnitude, duration, when));
boost::shared_ptr&lt;EulerIvpOdeSolver&gt; p_solver(new EulerIvpOdeSolver);

// convert a cellml model

// find cellml file in chaste source
FileFinder cellml_file("heart/src/odes/cellml/LuoRudy1991.cellml", RelativeTo::ChasteSourceRoot);
// location to put cellml file and conversion results
OutputFileHandler handler("converted_file_folder", true);
// copy cellml file to the output location
FileFinder copied_file = handler.CopyFileTo(cellml_file);
 // prepare converter
CellMLToSharedLibraryConverter converter(true);
// specify command line conversion options
converter.SetOptions({"--cvode", "--use-analytic-jacobian"});
 //perform the conversion
DynamicCellModelLoaderPtr p_loader = converter.Convert(copied_file);
// Create a (pointer to) a cardiac cell and cast to the correct type (in ths case AbstractCvodeCell)
AbstractCvodeCell* lr91 = dynamic_cast&lt;AbstractCvodeCell*&gt;(p_loader-&gt;CreateCell(p_solver, p_stimulus));
</pre><p>
The <a class="ext-link" href="https://github.com/Chaste/cellml"><span class="icon">​</span>cellml project</a> contains many annotated CellML files which you may use in this fashion.
</p>
<h2 id="ModelannotationwithRDF">Model annotation with RDF</h2>
<p>
CellML files may include metadata through the use of <a class="ext-link" href="http://en.wikipedia.org/wiki/Resource_Description_Framework"><span class="icon">​</span>RDF</a>, the Resource Description Framework (see the <a class="ext-link" href="http://www.cellml.org/specifications/metadata"><span class="icon">​</span>CellML metadata specification</a> for more information).  chaste_codegen makes use of several different annotations when generating C++ source code for Chaste.
</p>
<p>
Some annotations are be required to enable successful code generation.  In particular, chaste_codegen needs to know which variables represent voltage, the transmembrane potential and stimulus current, in order to link the models into the mono/bi-domain equations.  (If the model does not have a stimulus current because it represents a self-excitatory cell, it should be <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#Self-excitatorymodels">annotated to indicate this</a>.) Unlike its predecessor chaste_codegen does not try to guess based on names in the model. so <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#Standardisednames">name annotations</a> must be used. You may also need to annotate the membrane capacitance if its value is required for automatic units conversions (if the model uses amps as the dimensions of transmembrane currents).
</p>
<p>
All metadata annotations must occur within an <tt>&lt;rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;</tt> element.  Such an element may occur within any CellML element, so you may place annotations next to the variable being annotated, or in a single <tt>rdf:RDF</tt> element at the top level of the model, as you prefer.  Variables to be annotated must have a <tt>cmeta:id</tt> attribute, which is used to identify the variable in the annotation.
</p>
<p>
Each annotation takes the form of an <tt>rdf:Description</tt> element:
</p>
<div class="code"><pre><span class="nt">&lt;rdf:Description</span> <span class="na">rdf:about=</span><span class="s">"#cmeta_id"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- Annotation element goes here --&gt;</span>
<span class="nt">&lt;/rdf:Description&gt;</span>
</pre></div><p>
where "<tt>cmeta_id</tt>" is replaced by the value of the <tt>cmeta:id</tt> attribute on the variable being annotated.
</p>
<p>
The following annotations are understood by chaste_codegen. See the CellML files in <a class="source" href="/trac/browser/trunk/heart/src/odes/cellml">source:trunk/heart/src/odes/cellml</a> for examples of their use.
</p>
<h3 id="Standardisednames">Standardised names</h3>
<div class="code"><pre><span class="nt">&lt;bqbiol:is</span> <span class="na">xmlns:bqbiol=</span><span class="s">"http://biomodels.net/biology-qualifiers/"</span>
           <span class="na">rdf:resource=</span><span class="s">"https://chaste.comlab.ox.ac.uk/cellml/ns/oxford-metadata#standard-name"</span><span class="nt">/&gt;</span>
</pre></div><p>
This can be used to specify the 'standard' (to chaste_codegen) name of this variable.  Replace '<tt>standard-name</tt>' with the name in question.  
</p>
<p>
<strong>The full list of allowed names can be found within the <tt>oxford-metadata.ttl</tt> file in the <a class="ext-link" href="https://github.com/ModellingWebLab/ontologies"><span class="icon">​</span>Web Lab Ontology source code</a></strong>.
</p>
<p>
To update the 'official' metadata list -- Check with Gary first! -- you need to update the .ttl file, and then run a build on a machine with a newish version of python rdflib installed (to ensure that <tt>oxford-metadata.rdf</tt> is also updated to match), preferably using python 3.
</p>
<p>
Updating the official metadata should only be done for metadata that is generally reusable.
</p>
<p>
Currently only a few of these names, shown below, have special meaning to the Chaste CellML translation process.
</p>
<ul><li><tt>membrane_voltage</tt> - the transmembrane potential <strong>please note:</strong> this is now required chaste_codegen conversion will fail if it is not present
</li><li><tt>membrane_capacitance</tt> - this is useful if converting the model current units to those expected by Chaste requires knowledge of the cell's membrane capacitance
</li><li><tt>cytosolic_calcium_concentration</tt> - if this variable is present, the generated class will define the <tt>GetIntracellularCalciumConcentration</tt> method
</li><li><tt>membrane_stimulus_current</tt> - specifies which variable represents the intracellular stimulus current
</li><li><tt>membrane_stimulus_current_amplitude</tt>, <tt>membrane_stimulus_current_duration</tt>, <tt>membrane_stimulus_current_period</tt>, <tt>membrane_stimulus_current_offset</tt> - if the stimulus coded in the model is a regular square wave, the relevant parameters may be annotated to allow chaste_codegen to define the <tt>UseCellMLDefaultStimulus</tt> method that uses a <tt>RegularStimulus</tt> class.  The presence of <tt>membrane_stimulus_current_offset</tt> is optional.
</li></ul><p>
<strong>Please note:</strong> all non-state-variables, annotated in this way, are accessible as <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#Modifiableparameters">parameters</a> or <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#Derivedquantities">derived quantities</a>, as appropriate. This will thus make them accessible via the <tt>GetAnyVariable</tt> and <tt>OutputVariables</tt> functionality.  This includes state variables annotated with new tags that otherwise do not have a meaning in the ontology.
</p>
<p>
Full example:
</p>
<div class="code"><pre><span class="nt">&lt;variable</span> <span class="na">name=</span><span class="s">"V"</span> <span class="na">units=</span><span class="s">"millivolt"</span> <span class="na">initial_value=</span><span class="s">"-80"</span> <span class="na">public_interface=</span><span class="s">"out"</span> <span class="na">cmeta:id=</span><span class="s">"membrane_voltage"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;rdf:RDF</span> <span class="na">xmlns:rdf=</span><span class="s">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span> <span class="na">xmlns:bqbiol=</span><span class="s">"http://biomodels.net/biology-qualifiers/"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;rdf:Description</span> <span class="na">rdf:about=</span><span class="s">"#membrane_voltage"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;bqbiol:is</span> <span class="na">rdf:resource=</span><span class="s">"https://chaste.comlab.ox.ac.uk/cellml/ns/oxford-metadata#membrane_voltage"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/rdf:Description&gt;</span>
   <span class="nt">&lt;/rdf:RDF&gt;</span>
<span class="nt">&lt;/variable&gt;</span>
</pre></div><p>
We also use these standardised names to interface between models and protocol definitions in the <a class="wiki" href="/trac/wiki/FunctionalCuration">FunctionalCuration</a> system.
</p>
<h3 id="chaste_codegenconversionspecificparameters">chaste_codegen conversion specific parameters</h3>
<p>
In addition to the standardised names there are a number of conversion specific annotations that can be added to a cellml model, described below.
</p>
<p>
The namespace for this annotation is named <tt>https://chaste.comlab.ox.ac.uk/cellml/ns/pycml#</tt> for historical reasons to ensure compatibility with cellml models marked up for chaste_codegen's predecessor.
</p>
<h4 id="Modifiableparameters">Modifiable parameters</h4>
<div class="code"><pre><span class="nt">&lt;modifiable-parameter</span> <span class="na">xmlns=</span><span class="s">"https://chaste.comlab.ox.ac.uk/cellml/ns/pycml#"</span><span class="nt">&gt;</span>yes<span class="nt">&lt;/modifiable-parameter&gt;</span>
</pre></div><p>
This specifies that the variable should become a named parameter within the C++ class, with name given by its <tt>cmeta:id</tt> (unless it has a <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#Standardisednames">standardised name</a>, in which case that is used).  The variable can then be altered at run-time, via calls to the <tt>SetParameter</tt> method.  Such parameters can also be set via the <tt>ChasteParameters</tt> XML file, as described <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#UseofCellMLinthecardiacexecutable">above</a>, and selected for output using the <tt>OutputVariables</tt> functionality.
</p>
<p>
Full example:
</p>
<div class="code"><pre><span class="nt">&lt;variable</span> <span class="na">units=</span><span class="s">"dimensionless"</span> <span class="na">name=</span><span class="s">"ScaleFactorGkr"</span> <span class="na">initial_value=</span><span class="s">"1.0"</span> <span class="na">cmeta:id=</span><span class="s">"ScaleFactorGkr"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;rdf:RDF</span> <span class="na">xmlns:rdf=</span><span class="s">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;rdf:Description</span> <span class="na">rdf:about=</span><span class="s">"#ScaleFactorGkr"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;modifiable-parameter</span> <span class="na">xmlns=</span><span class="s">"https://chaste.comlab.ox.ac.uk/cellml/ns/pycml#"</span><span class="nt">&gt;</span>yes<span class="nt">&lt;/modifiable-parameter&gt;</span>
    <span class="nt">&lt;/rdf:Description&gt;</span>
  <span class="nt">&lt;/rdf:RDF&gt;</span>
<span class="nt">&lt;/variable&gt;</span>
</pre></div><h4 id="Derivedquantities">Derived quantities</h4>
<div class="code"><pre><span class="nt">&lt;derived-quantity</span> <span class="na">xmlns=</span><span class="s">"https://chaste.comlab.ox.ac.uk/cellml/ns/pycml#"</span><span class="nt">&gt;</span>yes<span class="nt">&lt;/derived-quantity&gt;</span>
</pre></div><p>
This specifies that the variable should become a derived quantity within the C++ class, with name given by its <tt>cmeta:id</tt> (unless it has a <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#Standardisednames">standardised name</a>, in which case that is used).  Derived quantities may be computed using the <tt>ComputeDerivedQuantities</tt> and <tt>ComputeDerivedQuantitiesFromCurrentState</tt> methods, and selected for output using the <tt>OutputVariables</tt> functionality.  This is useful for quantities which are not necessary for computing the time evolution of the model, but still of interest.
</p>
<p>
Full example:
</p>
<div class="code"><pre><span class="nt">&lt;variable</span> <span class="na">name=</span><span class="s">"F"</span> <span class="na">units=</span><span class="s">"coulomb_per_millimole"</span> <span class="na">public_interface=</span><span class="s">"in"</span> <span class="na">cmeta:id=</span><span class="s">"K_F"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;rdf:RDF</span> <span class="na">xmlns:rdf=</span><span class="s">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span> <span class="na">xmlns:bqbiol=</span><span class="s">"http://biomodels.net/biology-qualifiers/"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;rdf:Description</span> <span class="na">rdf:about=</span><span class="s">"#K_F"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;pycml:derived-quantity&gt;</span>yes<span class="nt">&lt;/pycml:derived-quantity&gt;</span>
    <span class="nt">&lt;/rdf:Description&gt;</span>
<span class="nt">&lt;/rdf:RDF&gt;</span>
<span class="nt">&lt;/variable&gt;</span>

</pre></div><h4 id="Variablerangechecking">Variable range checking</h4>
<p>
Chaste has the ability to check at each time step that cell model variables have not gone out of an expected range.  This is especially useful for gating variables, which must lie between 0 and 1, being probabilities.  In order to take advantage of this, you must annotate your model to specify the expected range, using the <tt>pycml:range-low</tt> and <tt>pycml:range-high</tt> annotations, e.g.
</p>
<div class="code"><pre><span class="nt">&lt;range-low</span> <span class="na">xmlns=</span><span class="s">"https://chaste.comlab.ox.ac.uk/cellml/ns/pycml#"</span><span class="nt">&gt;</span>0<span class="nt">&lt;/range-low&gt;</span>
<span class="nt">&lt;range-high</span> <span class="na">xmlns=</span><span class="s">"https://chaste.comlab.ox.ac.uk/cellml/ns/pycml#"</span><span class="nt">&gt;</span>1<span class="nt">&lt;/range-high&gt;</span>
</pre></div><p>
The range specified is treated as a closed interval.
</p>
<p>
Full example:
</p>
<div class="code"><pre><span class="nt">&lt;rdf:RDF</span> <span class="na">xmlns:rdf=</span><span class="s">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;rdf:Description</span> <span class="na">rdf:about=</span><span class="s">"#gating_variable"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;range-low</span> <span class="na">xmlns=</span><span class="s">"https://chaste.comlab.ox.ac.uk/cellml/ns/pycml#"</span><span class="nt">&gt;</span>0<span class="nt">&lt;/range-low&gt;</span>
        <span class="nt">&lt;range-high</span> <span class="na">xmlns=</span><span class="s">"https://chaste.comlab.ox.ac.uk/cellml/ns/pycml#"</span><span class="nt">&gt;</span>1<span class="nt">&lt;/range-high&gt;</span>
    <span class="nt">&lt;/rdf:Description&gt;</span>
<span class="nt">&lt;/rdf:RDF&gt;</span>
</pre></div><h4 id="Self-excitatorymodels">Self-excitatory models</h4>
<p>
This stops chaste_codegen looking for a stimulus current in the model, so that sino-atrial node models can be used in Chaste.
In this case, you need to annotate the model itself, i.e. the <tt>cmeta:id</tt> used should be that on the <tt>model</tt> element.  For example,
</p>
<div class="code"><pre><span class="nt">&lt;rdf:RDF</span> <span class="na">xmlns:rdf=</span><span class="s">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;rdf:Description</span> <span class="na">rdf:about=</span><span class="s">"#demir_model_1994"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;is-self-excitatory</span> <span class="na">xmlns=</span><span class="s">"https://chaste.comlab.ox.ac.uk/cellml/ns/pycml#"</span><span class="nt">&gt;</span>yes<span class="nt">&lt;/is-self-excitatory&gt;</span>
    <span class="nt">&lt;/rdf:Description&gt;</span>
<span class="nt">&lt;/rdf:RDF&gt;</span>
</pre></div><h4 id="Namedattributes">Named attributes</h4>
<p>
After release 2.1 Chaste has gained the ability to use real-valued named attributes associated with ODE classes.  chaste_codegen can use this functionality to transfer named attributes from a CellML into Chaste, so they are available for querying by other Chaste code.  This will not typically be of use to executable users, but developers working with Chaste may find it useful.  For example, such annotations could specify various "typical values" for the cell model, such as normal cycle length, or suggested forward Euler time step.
</p>
<p>
These are model annotations, i.e. the <tt>cmeta:id</tt> used should be that on the <tt>model</tt> element.  For example,
</p>
<div class="code"><pre><span class="nt">&lt;rdf:RDF</span> <span class="na">xmlns:rdf=</span><span class="s">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;rdf:Description</span> <span class="na">rdf:about=</span><span class="s">"#luo_rudy_1991"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;named-attribute</span> <span class="na">xmlns=</span><span class="s">"https://chaste.comlab.ox.ac.uk/cellml/ns/pycml#"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;rdf:Description&gt;</span>
            <span class="nt">&lt;name</span> <span class="na">rdf:datatype=</span><span class="s">"http://www.w3.org/2000/10/XMLSchema#string"</span><span class="nt">&gt;</span>SuggestedCycleLength<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;value</span> <span class="na">rdf:datatype=</span><span class="s">"http://www.w3.org/2000/10/XMLSchema#double"</span><span class="nt">&gt;</span>750<span class="nt">&lt;/value&gt;</span>
         <span class="nt">&lt;/rdf:Description&gt;</span>
      <span class="nt">&lt;/named-attribute&gt;</span>
      <span class="nt">&lt;named-attribute</span> <span class="na">xmlns=</span><span class="s">"https://chaste.comlab.ox.ac.uk/cellml/ns/pycml#"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;rdf:Description&gt;</span>
            <span class="nt">&lt;name</span> <span class="na">rdf:datatype=</span><span class="s">"http://www.w3.org/2000/10/XMLSchema#string"</span><span class="nt">&gt;</span>SuggestedForwardEulerTimestep<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;value</span> <span class="na">rdf:datatype=</span><span class="s">"http://www.w3.org/2000/10/XMLSchema#double"</span><span class="nt">&gt;</span>0.005<span class="nt">&lt;/value&gt;</span>
         <span class="nt">&lt;/rdf:Description&gt;</span>
      <span class="nt">&lt;/named-attribute&gt;</span>
   <span class="nt">&lt;/rdf:Description&gt;</span>
<span class="nt">&lt;/rdf:RDF&gt;</span>
</pre></div><h3 id="Combiningannotations">Combining annotations</h3>
<p>
It is possible to combine annotations. The example below shows a variable that is a cytosolic_calcium_concentration but is also maked as derived quantity:
</p>
<div class="code"><pre><span class="nt">&lt;variable</span> <span class="na">name=</span><span class="s">"Ca_i"</span> <span class="na">units=</span><span class="s">"mM"</span> <span class="na">public_interface=</span><span class="s">"out"</span> <span class="na">cmeta:id=</span><span class="s">"cytosolic_calcium_concentration"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;rdf:RDF</span> <span class="na">xmlns:rdf=</span><span class="s">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span> <span class="na">xmlns:bqbiol=</span><span class="s">"http://biomodels.net/biology-qualifiers/"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;rdf:Description</span> <span class="na">rdf:about=</span><span class="s">"#cytosolic_calcium_concentration"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;derived-quantity</span> <span class="na">xmlns=</span><span class="s">"https://chaste.comlab.ox.ac.uk/cellml/ns/pycml#"</span><span class="nt">&gt;</span>yes<span class="nt">&lt;/derived-quantity&gt;</span>
            <span class="nt">&lt;bqbiol:is</span> <span class="na">rdf:resource=</span><span class="s">"https://chaste.comlab.ox.ac.uk/cellml/ns/oxford-metadata#cytosolic_calcium_concentration"</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/rdf:Description&gt;</span>
   <span class="nt">&lt;/rdf:RDF&gt;</span>
<span class="nt">&lt;/variable&gt;</span>
</pre></div><h2 id="chaste_codegencommandlinearguments">chaste_codegen command line arguments</h2>
<p>
chaste_codegen can be supplied with command line arguments directly, to specify the desired conversion. <strong>Please note:</strong> Unlike its predecessor chaste_codegen does not make use of config files.
</p>
<h3 id="activation">activation</h3>
<p>
The chaste_codegen tool is developed in python3 and is best installed in a python3 virtual environment. The chaste build process automatically sets up chaste_codegen in the build folder (in the <tt>&lt;build_folder&gt;/codegen_python3_venv</tt>) but it can also be installed manually if desired See <a class="wiki" href="/trac/wiki/InstallCodegen">InstallCodegen</a>.
</p>
<p>
To use the commands below, you can first activate the environment as follows from your build folder: <tt>source codegen_python3_venv/bin/activate</tt>. 
</p>
<p>
(If you manually installed a virtual environment use its name instead of source codegen_python3_venv, from the correct location).
</p>
<p>
Alternatively you can prefix the chaste_codegen command with the full path to the bin folder in the virtual environment  e.g. <tt>/home/maurice/chaste_build/source codegen_python3_venv/bin/chaste_codegen</tt>  without the need to activate the environment.
</p>
<h3 id="commandlinearguments">command line arguments</h3>
<p>
<tt>chaste_codegen -h</tt> displays the help giving a full overview of what is available.
</p>
<p>
There are a number of different arguments: <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#Thecellmlfile">the cellml file</a>, <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#Modeltypes">model types</a>, <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#Chasteoptions">Chaste options</a> and <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#Generatedcodeoptions">Generated code options</a>. Below is a summery of some of the most common options.
</p>
<h3 id="Thecellmlfile">The cellml file</h3>
<p>
chaste_codegen takes what the help calls a "positional argument". This is the cellml file being converted e.g. <tt>chaste_codegen hodgkin_huxley_squid_axon_model_1952_modified.cellml</tt>.
</p>
<p>
Other arguments (preceded by -- or -) can be placed before or after the cellml file in any order.
</p>
<h3 id="Modeltypes">Model types</h3>
<p>
There are arguments that control what kind of model (CardiacCell) is being generated.
</p>
<h4 id="GeneratinganormalmodelorstandardAbstractCardiacCellsubclass.">Generating a normal model, or standard <tt>AbstractCardiacCell</tt> subclass.</h4>
<p>
This can be generated using the <tt>--normal</tt> argument e.g. 
</p>
<p>
<tt>chaste_codegen hodgkin_huxley_squid_axon_model_1952_modified.cellml --normal</tt>. 
</p>
<p>
This is the default if no transformation type is indicated an <tt>AbstractCardiacCell</tt> will also be generated.
</p>
<h4 id="GenerateCVODEcellsAbstractCvodeCellsubclass.">Generate CVODE cells, <tt>AbstractCvodeCell</tt> subclass.</h4>
<p>
Cvode cells can be generated using the <tt>--cvode</tt> argument. chaste_codegen can generate its own analytic jacobian. To include an analytics jacobian combine <tt>--cvode</tt> with <tt>--use-analytic-jacobian</tt> (or <tt>-j</tt>) e.g. 
</p>
<p>
<tt>chaste_codegen hodgkin_huxley_squid_axon_model_1952_modified.cellml --cvode --use-analytic-jacobian</tt>
</p>
<h4 id="GenerateCVODEcellswithdataclamp">Generate CVODE cells with data clamp</h4>
<p>
A subclass <tt>AbstractCvodeCellWithDataClamp</tt> allows the 'data clamp' proposed by <a class="ext-link" href="http://www.ncbi.nlm.nih.gov/pubmed/15142755"><span class="icon">​</span>Dokos &amp; Lovell (2004)</a> to be applied to any CellML model. This can be generated using the <tt>--cvode-data-clamp</tt> argument. If desired this cal also be generated with an analytic jacobian using the <tt>--use-analytic-jacobian</tt> (or <tt>-j</tt>) argument e.g.
</p>
<p>
<tt>chaste_codegen hodgkin_huxley_squid_axon_model_1952_modified.cellml --cvode-data-clamp --use-analytic-jacobian</tt>
</p>
<p>
This adds an additional current to the model, specified by:
</p>
<pre class="wiki">I_data = g_data*(V - V_data);
</pre><p>
<strong>Note:</strong> this current affects dV/dt for single cell simulations only. It is not reported by GetIIonic() so it <strong>I_data=0 in tissue sims</strong>!
</p>
<p>
This can be used via the methods:
</p>
<pre class="wiki">AbstractCvodeCellWithDataClamp::SetExperimentalData(std::vector&lt;double&gt; times, std::vector&lt;double&gt; voltages);
AbstractCvodeCellWithDataClamp::SetDataClampOn(double conductance);
AbstractCvodeCellWithDataClamp::SetDataClampOff();
</pre><h4 id="GeneratingBackwardEulercellsAbstractBackwardEulerCardiacCellsubclass.">Generating Backward Euler cells, <tt>AbstractBackwardEulerCardiacCell</tt> subclass.</h4>
<p>
This can be generated using the <tt>--backward-euler</tt> argument e.g. 
</p>
<p>
<tt>chaste_codegen hodgkin_huxley_squid_axon_model_1952_modified.cellml --backward-euler</tt>. 
</p>
<h4 id="GeneratingRushLarsencellsAbstractRushLarsenCardiacCellsubclass.">Generating Rush Larsen cells, <tt>AbstractRushLarsenCardiacCell</tt> subclass.</h4>
<p>
This can be generated using the <tt>--rush-larsen</tt> argument e.g. 
</p>
<p>
<tt>chaste_codegen hodgkin_huxley_squid_axon_model_1952_modified.cellml --rush-larsen</tt>.
</p>
<h4 id="GeneratingGeneralizedRushLarsencellsAbstractGeneralizedRushLarsenCardiacCellsubclass.">Generating Generalized Rush Larsen cells, <tt>AbstractGeneralizedRushLarsenCardiacCell</tt> subclass.</h4>
<p>
chaste_codegen can generate both a first-order generalisation as well as a second order generalisation. The arguments that can be used for this are <tt>--grl1</tt> and <tt>--grl2</tt> respectively so e.g. 
</p>
<p>
<tt>chaste_codegen hodgkin_huxley_squid_axon_model_1952_modified.cellml --grl1</tt> or <tt>chaste_codegen hodgkin_huxley_squid_axon_model_1952_modified.cellml --grl2</tt>
</p>
<h3 id="Chasteoptions">Chaste options</h3>
<p>
Chaste options:
</p>
<ul><li><tt>--dynamically-loadable</tt> (or <tt>-y</tt> or <tt>--dll</tt>), generate the code allowing it to be dynamically loaded. <strong>Please note:</strong> This method is mainly useful for the build system to generate code in the /dynamic folder or by the ​<a class="ext-link" href="https://chaste.cs.ox.ac.uk/chaste/docs/release_2021.1/classCellMLLoader.html" title="Documentation for the CellMLLoader class"><span class="icon">​</span>CellMLLoader</a>. It should not be used if generating code to include in the source of your project.
</li><li><tt>--opt</tt> generate an optimised version of the specified models with partial evaluation and lookup tables. Can be combine with any model type above.
</li><li><tt>--use-modifiers</tt> (or <tt>-m</tt>) adds modifier functions for metadata-annotated variables (except time &amp; stimulus). Only works with <tt>--normal</tt>, <tt>--cvode</tt> and <tt>--cvode-data-clamp</tt>
</li><li> <tt>--lookup-table &lt;metadata tag&gt; min max step</tt> indicates a lookup table different from the default. The argument must be followed by a metadata tag to identify the variable, a minimum and maximum value and a step. The argument can be repeated to specify lookup tables for multiple different variables. The default is <tt>membrane_voltage -250.0001, 549.9999, 0.001</tt>. <strong>Please note:</strong> Using this argument disables the default, so if a lookup table is required for a variable tagged as <tt>membrane_voltage</tt> it will need to be re-specified. Tags which are not present in the model are skipped.
</li></ul><h3 id="Generatedcodeoptions">Generated code options</h3>
<p>
These options do not affect what kind of cells get generated, but instead affect some general logistics. Unless otherwise specified these can be combined with other options.
The arguments are:
</p>
<ul><li><tt>-o OUTFILE</tt> specified the name of the generated code file. The outfile is expected to be header file (.hpp or .h), a code file (.cpp or .c) and the name given and its corresponding header/code file will be generated. <strong>Cannot be combined with <tt>--output-dir</tt></strong>. 
<ul><li>This can also be used with a cellml file, which will result in a .cpp and .hpp file with the name of he cellml file being generated. This is the <strong>default behaviour</strong> if <tt>-o</tt> is not specified.
</li></ul></li><li><tt>--output-dir OUTPUT_DIR</tt> specified an output folder for generated code. <strong>Cannot be combined with <tt>-o</tt></strong>
</li><li><tt>--show-outputs</tt> instead of generating code this option shows what files would be generated (one per line) if the command was run without the option.
</li><li><tt>-c CLS_NAME</tt> explicitly sets the name of the generated class. If this option is not used, the class name is based on the name of the cellml file.
</li><li> <tt>--quiet</tt> (or <tt>-q</tt>) disables warning and informational messages.
</li></ul><h2 id="UseofCellMLinthecardiacexecutable">Use of CellML in the cardiac executable</h2>
<p>
The <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/BuildingExecutableApps.html">cardiac executable</a> has the ability to automatically load cell models encoded as CellML files at run-time. In order to take advantage of this, you need (at present) to have built the executable from source yourself, as it uses your Chaste source tree to convert the CellML file into runnable code.
</p>
<p>
To specify one of the models included within Chaste in the parameters file, you now need to wrap it in a &lt;Hardcoded&gt; element, e.g.
</p>
<div class="code"><pre><span class="nt">&lt;Hardcoded&gt;</span>FaberRudy2000<span class="nt">&lt;/Hardcoded&gt;</span>
</pre></div><p>
Specify a dynamically loaded model using the &lt;Dynamic&gt; element instead, e.g.
</p>
<div class="code"><pre><span class="nt">&lt;Dynamic&gt;</span>
    <span class="nt">&lt;Path</span> <span class="na">relative_to=</span><span class="s">"chaste_build_root"</span><span class="nt">&gt;</span>heart/dynamic/libDynamicallyLoadableLr91.so<span class="nt">&lt;/Path&gt;</span>
<span class="nt">&lt;/Dynamic&gt;</span>
</pre></div><p>
The path may either point to a pre-compiled shared library (as in the example), or a CellML file. If the latter, a shared library will be created in the same folder as the CellML file, and loaded by the executable at run-time. See <a class="source" href="/trac/browser/trunk/heart/test/data/xml/ChasteParametersFullFormat.xml">source:trunk/heart/test/data/xml/ChasteParametersFullFormat.xml</a><a class="trac-rawlink" href="/trac/export/HEAD/chaste/trunk/heart/test/data/xml/ChasteParametersFullFormat.xml" title="Download">​</a>​ for a full example parameters file.
</p>
<p>
Chaste allows modifying certain parameters of the models within user-defined regions of the tissue. This is incorporated within the cell heterogeneity support in the parameters file:
</p>
<div class="code"><pre><span class="nt">&lt;CellHeterogeneity&gt;</span>
        <span class="nt">&lt;Location</span> <span class="na">unit=</span><span class="s">"cm"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;Cuboid&gt;</span>
                        <span class="nt">&lt;LowerCoordinates</span> <span class="na">x=</span><span class="s">"-2.0"</span> <span class="na">y=</span><span class="s">"-0.1"</span> <span class="na">z=</span><span class="s">"-1.0"</span><span class="nt">/&gt;</span>
                        <span class="nt">&lt;UpperCoordinates</span> <span class="na">x=</span><span class="s">"-0.5"</span> <span class="na">y=</span><span class="s">"0.1"</span> <span class="na">z=</span><span class="s">"1.0"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/Cuboid&gt;</span>
        <span class="nt">&lt;/Location&gt;</span>
        <span class="nt">&lt;SetParameter</span> <span class="na">name=</span><span class="s">"example"</span> <span class="na">value=</span><span class="s">"0.0"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;SetParameter</span> <span class="na">name=</span><span class="s">"example2"</span> <span class="na">value=</span><span class="s">"2.0"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/CellHeterogeneity&gt;</span>
</pre></div><p>
Parameters to be modified in this way must be annotated specially in the CellML file - you cannot just modify any variable in the model. Each variable must have a cmeta:id specified (this gives the name used in the SetParameter element) and an RDF annotation added, e.g.
</p>
<div class="code"><pre><span class="nt">&lt;rdf:RDF</span> <span class="na">xmlns:rdf=</span><span class="s">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;rdf:Description</span> <span class="na">rdf:about=</span><span class="s">"#example"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;modifiable-parameter</span> <span class="na">xmlns=</span><span class="s">"https://chaste.comlab.ox.ac.uk/cellml/ns/pycml#"</span><span class="nt">&gt;</span>yes<span class="nt">&lt;/modifiable-parameter&gt;</span>
        <span class="nt">&lt;/rdf:Description&gt;</span>
<span class="nt">&lt;/rdf:RDF&gt;</span>
</pre></div><p>
Such a block may be placed inside any CellML element, but placing it within or next to the annotated variable is recommended. See <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#ModelannotationwithRDF">Model annotation with RDF</a> for more. The older scale factor support, which was hardcoded is no longer supported
</p>
<p>
Variable annotation as a parameter or derived quantity is also important to support the OutputVariables functionality in the executable. Any variable thus annotated, or any state variable, may be specified to be included in the output data along with <tt>V</tt> and <tt>phi_e</tt>.
</p>
<p>
<strong>Please note:</strong> As chaste_codegen does not use config files, options controlling the code generation process for the CellML file are as follows:
</p>
<ul><li>Set <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#Project-specificconversionoptions">Project-specific conversion options</a>.
</li><li>Use chaste_codegen to manually create .cpp and .hpp files (see <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#chaste_codegencommandlinearguments">chaste_codegen command line arguments</a>), include these in your project source and either directly include or point your parameters file at the shared library that results from its compilation.
</li><li>Use <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#UsingdynamicallyloadedCellMLmodelsinChastetestsorprojects">dynamic loading</a> to convert the code and point the parameters file at the cellml file in the conversion folder, it will pick up the converted version.
</li><li>Use <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#UsingdynamicallyloadedCellMLmodelsinChastetestsorprojects">dynamic loading</a> via code instead.
</li></ul><h2 id="Installingchaste_codegen">Installing chaste_codegen</h2>
<p>
See <a class="wiki" href="/trac/wiki/InstallCodegen">InstallCodegen</a>.
</p>
<h2 id="TroubleShooting"><a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/TroubleShooting.html">TroubleShooting</a></h2>
<p>
See <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/TroubleShooting.html#chaste_codegenErrors">TroubleShooting</a>
</p>
<h2 id="SummaryofchangescomparedtoPyCml">Summary of changes compared to PyCml</h2>
<p>
This section highlights the main difference between chaste_codegen and its predecessor <a class="missing wiki">PyCml?</a>. The two work in broadly similar ways, but there are some key differences.
</p>
<ul><li>chaste_codegen generates its own analytic jacobians and the <tt>--use-analytic-jacobian</tt> (or <tt>-j</tt>) argument is now used without specifying an out file. Where a two-step process was required it is no longer required.
</li><li>chaste_codegen does not make use of config files. 
<ul><li>The only way to specify what kind of code to generate is now via the command line arguments. 
</li><li>To generate different models from the default, use <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#UsingdynamicallyloadedCellMLmodelsinChastetestsorprojects">dynamic loading</a> or set <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#Project-specificconversionoptions">Project-specific conversion options</a>.
</li><li>Lookup table settings can also be specified via the command line see <a class="wiki" href="https://chaste.github.io/old_releases/release_2021.1/ChasteGuides/CodeGenerationFromCellML.html#Chasteoptions">Chaste options</a>
</li></ul></li><li>chaste_codegen is fully re-written for python3 and during the build process a virtual environment is set up with the required packages, see <a class="wiki" href="/trac/wiki/InstallCodegen">InstallCodegen</a>.
</li></ul></div>
          

    </div>
  </body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <title>InstallGuides/TestingMultipleVersions - Chaste</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="/trac-static/css/trac.css" type="text/css" />
    <link rel="stylesheet" href="/trac-static/css/wiki.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/trac-static/css/site.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <p>
          <a id="logo" href="http://www.cs.ox.ac.uk/chaste"><img src="/logos/chaste-266x60.jpg" alt="Chaste logo" height="60" width="266" /></a>
          <em>Documentation for <a href="/chaste/tutorials/release_3.3/">Release 3.3</a>.</em>
        </p>
      </div>
    </div>
    <p>&nbsp;</p>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          <div id="wikipage" class="trac-content"><h1 id="InstallingmultipleversionsofChastesdependenciesfortestingcompatibility">Installing multiple versions of Chaste's dependencies for testing compatibility</h1>
<p>
As part of Chaste's automated testing, we build and run our main test packs with a range of different library versions, to ensure we do not inadvertently break support.  This page describes the steps used to set up the machine that runs these tests, and hence needs many different versions of the dependencies installed.  Note that using different dependency versions also requires support in the <a class="wiki" href="/chaste/tutorials/release_3.3/ChasteGuides/HostconfigSystem.html">hostconfig configuration</a>, a snippet of which is included below (the definitive version is at <a class="missing source">source:trunk/python/hostconfig/machines/chaste64.py</a>, and is not publicly accessible).
</p>
<p>
A pre-requisite to the instructions below is that a 'bob' account has been set up as a normal automated build account, and the <tt>.bashrc</tt> file of the account running the instructions contains the following (at the top):
</p>
<pre class="wiki">export PATH=$HOME/mpi/bin:$HOME/hdf5/bin:$HOME/bin:$PATH
source /opt/intel/bin/compilervars.sh intel64
export INTEL_LICENSE_FILE="28519@flexlm.nsms.ox.ac.uk"
</pre><p>
The following bash script was used to install the dependencies.
</p>
<div class="code"><pre>
<span class="c"># Link to the existing bob account for some dependencies
</span>
<span class="c"># Either link to bob for MPICH / ParMetis or see below
#ln -s ~bob/mpi
#ln -s /home/bob/ParMetis-3.1/
</span>
<span class="c"># The folder where automated builds will take place
</span>mkdir -p eclipse/workspace

<span class="c"># Dependency sources go in ~/src
</span>mkdir -p ~/src
<span class="nb">cd</span> ~/src

wget https://chaste.cs.ox.ac.uk/trac/raw-attachment/wiki/InstallGuides/NonRootDeveloper/mpich-1.2.7p1.tar.gz
wget http://glaros.dtc.umn.edu/gkhome/fetch/sw/parmetis/OLD/ParMetis-3.1.tar.gz

wget http://ftp.mcs.anl.gov/pub/petsc/release-snapshots/petsc-lite-2.3.3-p15.tar.gz
wget http://ftp.mcs.anl.gov/pub/petsc/release-snapshots/petsc-lite-2.3.2-p4.tar.gz
wget http://ftp.mcs.anl.gov/pub/petsc/release-snapshots/petsc-lite-3.0.0-p12.tar.gz
wget http://ftp.mcs.anl.gov/pub/petsc/release-snapshots/petsc-lite-3.1-p8.tar.gz
wget http://ftp.mcs.anl.gov/pub/petsc/release-snapshots/petsc-lite-3.2-p7.tar.gz
wget http://ftp.mcs.anl.gov/pub/petsc/release-snapshots/petsc-lite-3.3-p5.tar.gz
wget http://ftp.mcs.anl.gov/pub/petsc/release-snapshots/petsc-lite-3.4.2.tar.gz
wget http://ftp.mcs.anl.gov/pub/petsc/release-snapshots/petsc-lite-3.5.2.tar.gz

wget http://downloads.sourceforge.net/project/boost/boost/1.37.0/boost_1_37_0.tar.bz2
wget http://downloads.sourceforge.net/project/boost/boost/1.42.0/boost_1_42_0.tar.bz2
wget http://downloads.sourceforge.net/project/boost/boost/1.46.1/boost_1_46_1.tar.bz2
wget http://downloads.sourceforge.net/project/boost/boost/1.48.0/boost_1_48_0.tar.bz2
wget http://downloads.sourceforge.net/project/boost/boost/1.49.0/boost_1_49_0.tar.bz2
wget http://downloads.sourceforge.net/project/boost/boost/1.51.0/boost_1_51_0.tar.bz2
wget http://downloads.sourceforge.net/project/boost/boost/1.53.0/boost_1_53_0.tar.bz2
wget http://downloads.sourceforge.net/project/boost/boost/1.54.0/boost_1_54_0.tar.bz2
wget http://downloads.sourceforge.net/project/boost/boost/1.55.0/boost_1_55_0.tar.bz2
wget http://downloads.sourceforge.net/project/boost/boost/1.56.0/boost_1_56_0.tar.bz2
wget http://downloads.sourceforge.net/project/boost/boost/1.57.0/boost_1_57_0.tar.bz2

wget http://www.hdfgroup.org/ftp/HDF5/prev-releases/hdf5-1.6.10/src/hdf5-1.6.10.tar.bz2
wget http://www.hdfgroup.org/ftp/HDF5/prev-releases/hdf5-1.8.9/src/hdf5-1.8.9.tar.bz2
wget http://www.hdfgroup.org/ftp/HDF5/current/src/hdf5-1.8.13.tar.bz2

wget http://mirror.ox.ac.uk/sites/rsync.apache.org/xerces/c/2/sources/xerces-c-src_2_8_0.tar.gz
wget http://mirror.ox.ac.uk/sites/rsync.apache.org/xerces/c/3/sources/xerces-c-3.1.1.tar.gz

wget http://www.codesynthesis.com/download/xsd/4.0/linux-gnu/x86_64/xsd-4.0.0-x86_64-linux-gnu.tar.bz2
wget http://www.codesynthesis.com/download/xsd/3.3/linux-gnu/x86_64/xsd-3.3.0-x86_64-linux-gnu.tar.bz2
wget http://www.codesynthesis.com/download/xsd/3.2/linux-gnu/x86_64/xsd-3.2.0-x86_64-linux-gnu.tar.bz2
wget http://www.codesynthesis.com/download/xsd/3.1/linux-gnu/x86_64/xsd-3.1.0-x86_64-linux-gnu.tar.bz2
wget http://www.codesynthesis.com/download/xsd/2.3/linux-gnu/x86_64/xsd-2.3.1-x86_64-linux-gnu.tar.bz2

wget https://computation.llnl.gov/casc/sundials/download/code/old/cvode-2.6.0.tar.gz
wget https://computation.llnl.gov/casc/sundials/download/code/old/cvode-2.5.0.tar.gz
wget https://computation.llnl.gov/casc/sundials/download/code/cvode-2.7.0.tar.gz

wget http://www.cmake.org/files/v2.8/cmake-2.8.12.2.tar.gz
wget http://www.vtk.org/files/release/5.10/vtk-5.10.1.tar.gz
wget http://www.vtk.org/files/release/6.0/vtk-6.0.0.tar.gz
wget http://www.vtk.org/files/release/6.1/VTK-6.1.0.tar.gz

<span class="k">for </span>f in *gz; <span class="k">do </span>tar -zxf <span class="nv">$f</span>; <span class="k">done
for </span>f in *bz2; <span class="k">do </span>tar -jxf <span class="nv">$f</span>; <span class="k">done</span>


<span class="c"># Texttest, for acceptance testing
</span><span class="nb">cd
</span>wget http://downloads.sourceforge.net/project/texttest/texttest/3.19/texttest-3.19.zip
unzip texttest-3.19.zip
mv texttest-3.19.zip src/


<span class="c"># CodeSynthesis XSD
</span><span class="nb">cd</span> ~/src
mv xsd-*-linux-gnu ..


<span class="c"># CVODE
</span><span class="nb">cd</span> ~/src
wget --no-check-certificate https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/raw-attachment/wiki/InstallCvode/cvode.patch
<span class="nb">cd</span> ~/src/cvode-2.5.0/
patch -p0 &lt; ../cvode.patch 
./configure --prefix<span class="o">=</span><span class="nv">$HOME</span>/cvode --with-cflags<span class="o">=</span>-O3 --with-fflags<span class="o">=</span>-O3 --disable-mpi <span class="o">&amp;&amp;</span> make <span class="o">&amp;&amp;</span> make install
<span class="nb">cd</span> ~/src/cvode-2.6.0/
patch -p0 &lt; ../cvode.patch 
./configure --prefix<span class="o">=</span><span class="nv">$HOME</span>/cvode_2_6 --with-cflags<span class="o">=</span>-O3 --with-fflags<span class="o">=</span>-O3 --disable-mpi <span class="o">&amp;&amp;</span> make <span class="o">&amp;&amp;</span> make install
<span class="nb">cd</span> ~/src/cvode-2.7.0/
patch -p0 &lt; ../cvode.patch 
./configure --prefix<span class="o">=</span><span class="nv">$HOME</span>/cvode_2_7 --with-cflags<span class="o">=</span>-O3 --with-fflags<span class="o">=</span>-O3 --disable-mpi <span class="o">&amp;&amp;</span> make <span class="o">&amp;&amp;</span> make install


<span class="c"># MPI - option
# Note that on userpc58 this is a symbolic link to the bob MPI - see top of script
</span><span class="nb">cd</span> ~/src/mpich-1.2.7p1
<span class="nv">CCFLAGS</span><span class="o">=</span>-fPIC <span class="nv">CFLAGS</span><span class="o">=</span>-fPIC  ./configure --prefix<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi --with-comm<span class="o">=</span>shared --with-device<span class="o">=</span>ch_shmem --enable-sharedlib --disable-f77
make
<span class="nb">cd </span>examples/test/
make testing
<span class="nb">cd</span> ../..
make install


<span class="c"># ParMETIS - option
# Note that on userpc58 this is a symbolic link to the bob ParMETIS - see top of script
</span><span class="nb">cd</span> ~/src/ParMetis-3.1/
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi/bin:<span class="k">${</span><span class="nv">PATH</span><span class="k">}</span>
cp Makefile.in Makefile.in.orig
sed <span class="s1">'s/mpicc/\/home\/lofty\/mpi\/bin\/mpicc/'</span> Makefile.in.orig &gt; Makefile.in 
make 


<span class="c"># Boost
</span><span class="nb">cd</span> ~/src/boost_1_37_0/
./configure --prefix<span class="o">=</span><span class="nv">$HOME</span>/boost_1_37 <span class="o">&amp;&amp;</span> make <span class="o">&amp;&amp;</span> make install
<span class="nb">cd</span> ~/src/boost_1_42_0/
./bootstrap.sh --prefix<span class="o">=</span><span class="nv">$HOME</span>/boost_1_42 <span class="o">&amp;&amp;</span> ./bjam install
<span class="nb">cd</span> ~/src/boost_1_46_1/
./bootstrap.sh --prefix<span class="o">=</span><span class="nv">$HOME</span>/boost_1_46_1 <span class="o">&amp;&amp;</span> ./bjam install
<span class="nb">cd</span> ~/src/boost_1_48_0/
./bootstrap.sh --prefix<span class="o">=</span><span class="nv">$HOME</span>/boost_1_48 <span class="o">&amp;&amp;</span> ./b2 install
<span class="nb">cd</span> ~/src/boost_1_49_0/
./bootstrap.sh --prefix<span class="o">=</span><span class="nv">$HOME</span>/boost_1_49 <span class="o">&amp;&amp;</span> ./b2 install
<span class="nb">cd</span> ~/src/boost_1_51_0/
./bootstrap.sh --prefix<span class="o">=</span><span class="nv">$HOME</span>/boost_1_51 <span class="o">&amp;&amp;</span> ./b2 install
<span class="nb">cd</span> ~/src/boost_1_53_0/
./bootstrap.sh --prefix<span class="o">=</span><span class="nv">$HOME</span>/boost_1_53 <span class="o">&amp;&amp;</span> ./b2 install
<span class="nb">cd</span> ~/src/boost_1_54_0/
./bootstrap.sh --prefix<span class="o">=</span><span class="nv">$HOME</span>/boost_1_54 <span class="o">&amp;&amp;</span> ./b2 install
<span class="nb">cd</span> ~/src/boost_1_55_0/
./bootstrap.sh --prefix<span class="o">=</span><span class="nv">$HOME</span>/boost_1_55 <span class="o">&amp;&amp;</span> ./b2 install
<span class="nb">cd</span> ~/src/boost_1_56_0/
./bootstrap.sh --prefix<span class="o">=</span><span class="nv">$HOME</span>/boost_1_56 <span class="o">&amp;&amp;</span> ./b2 install
<span class="nb">cd</span> ~/src/boost_1_57_0/
./bootstrap.sh --prefix<span class="o">=</span><span class="nv">$HOME</span>/boost_1_57 <span class="o">&amp;&amp;</span> ./b2 install


<span class="c"># HDF5
</span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="k">${</span><span class="nv">PATH</span><span class="k">}</span>:<span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi/bin
<span class="nb">cd</span> ~/src/hdf5-1.6.10/
<span class="nb">export </span><span class="nv">CC</span><span class="o">=</span>mpicc 
./configure --enable-parallel --prefix<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/hdf5 <span class="o">&amp;&amp;</span> make <span class="o">&amp;&amp;</span> make install
<span class="nb">cd</span> ~/src/hdf5-1.8.9/
./configure --enable-parallel --prefix<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/hdf5_1_8_9 <span class="o">&amp;&amp;</span> make <span class="o">&amp;&amp;</span> make install
<span class="nb">cd </span>hdf5-1.8.13
./configure --enable-parallel --prefix<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/hdf5_1_8_13 <span class="o">&amp;&amp;</span> make <span class="o">&amp;&amp;</span> make install


<span class="c"># Xerces
</span><span class="nb">cd</span> ~/src/xerces-c-src_2_8_0
<span class="nb">export </span><span class="nv">XERCESCROOT</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nb">cd</span> <span class="nv">$XERCESCROOT</span>/src/xercesc
./runConfigure -plinux -cgcc -xg++ -P<span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/xercesc_2_8 <span class="o">&amp;&amp;</span> make <span class="o">&amp;&amp;</span> make install

<span class="nb">cd</span> ~/src/xerces-c-3.1.1
./configure --enable-netaccessor-socket --prefix<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/xercesc_3_1 <span class="o">&amp;&amp;</span> make <span class="o">&amp;&amp;</span> make install


<span class="c"># PETSc
</span><span class="nb">cd</span> ~/src
mv petsc-<span class="o">[</span>0-9<span class="o">]</span>* ../

<span class="nb">cd</span> ~/petsc-2.3.2-p4/
<span class="nb">export </span><span class="nv">PETSC_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nb">unset </span>PETSC_ARCH <span class="c"># Just in case!
</span>./config/configure.py --download-c-blas-lapack<span class="o">=</span>1 --with-mpi-dir<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi --with-x<span class="o">=</span><span class="nb">false</span> -PETSC_ARCH<span class="o">=</span>linux-gnu --with-clanguage<span class="o">=</span>cxx --with-shared --with-fortran<span class="o">=</span>0 <span class="o">&amp;&amp;</span> make all
./config/configure.py --download-c-blas-lapack<span class="o">=</span>1 --with-mpi-dir<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi --with-x<span class="o">=</span><span class="nb">false</span> -PETSC_ARCH<span class="o">=</span>linux-gnu-opt --with-clanguage<span class="o">=</span>cxx --with-shared --with-fortran<span class="o">=</span>0 --with-debugging<span class="o">=</span>0 <span class="o">&amp;&amp;</span> make all
./config/configure.py --download-c-blas-lapack<span class="o">=</span>1 --with-mpi-dir<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi --with-x<span class="o">=</span><span class="nb">false</span> -PETSC_ARCH<span class="o">=</span>linux-gnu-profile --with-clanguage<span class="o">=</span>cxx --with-shared --with-fortran<span class="o">=</span>0 --CFLAGS<span class="o">=</span>-pg -CXXFLAGS<span class="o">=</span>-pg -LDFLAGS<span class="o">=</span>-pg <span class="o">&amp;&amp;</span> make all
./config/configure.py --with-cxx<span class="o">=</span>icpc --with-cc<span class="o">=</span>icc --with-vendor-compiler<span class="o">=</span>intel --with-mpi-dir<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi --with-x<span class="o">=</span><span class="nb">false</span>  --with-debugging<span class="o">=</span>0 -PETSC_ARCH<span class="o">=</span>linux-intel-opt-mkl --with-clanguage<span class="o">=</span>cxx --with-blas-lapack-dir<span class="o">=</span>/opt/intel/composerxe/mkl/lib/intel64/ --with-fortran<span class="o">=</span>0 <span class="o">&amp;&amp;</span> make all

<span class="nb">cd</span> ~/petsc-2.3.3-p15/
<span class="nb">export </span><span class="nv">PETSC_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nb">unset </span>PETSC_ARCH <span class="c"># Just in case!
</span>./config/configure.py --download-c-blas-lapack<span class="o">=</span>1 --with-mpi-dir<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi --with-x<span class="o">=</span><span class="nb">false</span> -PETSC_ARCH<span class="o">=</span>linux-gnu --with-clanguage<span class="o">=</span>cxx --with-shared --with-fortran<span class="o">=</span>0 <span class="o">&amp;&amp;</span> make all
./config/configure.py --download-c-blas-lapack<span class="o">=</span>1 --with-mpi-dir<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi --with-x<span class="o">=</span><span class="nb">false</span> --with-debugging<span class="o">=</span>0 -PETSC_ARCH<span class="o">=</span>linux-gnu-opt --with-clanguage<span class="o">=</span>cxx --with-shared --with-fortran<span class="o">=</span>0 <span class="o">&amp;&amp;</span> make all
./config/configure.py --download-c-blas-lapack<span class="o">=</span>1 --with-mpi-dir<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi --with-x<span class="o">=</span><span class="nb">false</span> -PETSC_ARCH<span class="o">=</span>linux-gnu-profile --with-clanguage<span class="o">=</span>cxx --with-shared --with-fortran<span class="o">=</span>0 --CFLAGS<span class="o">=</span>-pg -CXXFLAGS<span class="o">=</span>-pg -LDFLAGS<span class="o">=</span>-pg <span class="o">&amp;&amp;</span> make all

<span class="nb">cd</span> ~/petsc-3.0.0-p12/
<span class="nb">export </span><span class="nv">PETSC_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu
./config/configure.py --download-c-blas-lapack<span class="o">=</span>1 --with-mpi-dir<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared --with-fortran<span class="o">=</span>0 <span class="o">&amp;&amp;</span> make all
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu-opt
./config/configure.py --download-c-blas-lapack<span class="o">=</span>1 --with-mpi-dir<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi --with-x<span class="o">=</span><span class="nb">false</span> --with-debugging<span class="o">=</span>0 --with-clanguage<span class="o">=</span>cxx --with-shared --with-fortran<span class="o">=</span>0 <span class="o">&amp;&amp;</span> make all
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu-profile
./config/configure.py --download-c-blas-lapack<span class="o">=</span>1 --with-mpi-dir<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared --with-fortran<span class="o">=</span>0 --CFLAGS<span class="o">=</span>-pg -CXXFLAGS<span class="o">=</span>-pg -LDFLAGS<span class="o">=</span>-pg <span class="o">&amp;&amp;</span> make all

<span class="nb">cd</span> ~/petsc-3.1-p8/
<span class="nb">export </span><span class="nv">PETSC_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu
./config/configure.py --download-c-blas-lapack<span class="o">=</span>1 --with-mpi-dir<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared --with-fortran<span class="o">=</span>0 <span class="o">&amp;&amp;</span> make all
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu-opt
./config/configure.py --download-c-blas-lapack<span class="o">=</span>1 --with-mpi-dir<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi --with-x<span class="o">=</span><span class="nb">false</span> --with-debugging<span class="o">=</span>0 --with-clanguage<span class="o">=</span>cxx --with-shared --with-fortran<span class="o">=</span>0 <span class="o">&amp;&amp;</span> make all
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu-profile
./config/configure.py --download-c-blas-lapack<span class="o">=</span>1 --with-mpi-dir<span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/mpi --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared --with-fortran<span class="o">=</span>0 --CFLAGS<span class="o">=</span>-pg -CXXFLAGS<span class="o">=</span>-pg -LDFLAGS<span class="o">=</span>-pg <span class="o">&amp;&amp;</span> make all

<span class="c"># Note: this is dangerous!  Since PETSc has its own MPICH it needs its own HDF5, which will be used in preference to any lofty/_hostconfig specification
# See e.g. https://chaste.cs.ox.ac.uk/tests.py/testsuite?buildType=_hostconfig,petsc=3-2,hdf5=1-8,boost=1-40,xsd=4-0,cvode=2-7&amp;machine=userpc59.cs.ox.ac.uk&amp;revision=23319&amp;runtime=0&amp;status=OK&amp;testsuite=global-test-TestChasteBuildInfo&amp;timestamp=1420204242.7705&amp;type=nightly which reports using HDF5 1.8.6 (despite 1.8.9 being installed above),
# and https://chaste.cs.ox.ac.uk/tests.py/testsuite?buildType=_hostconfig,petsc=3-3,hdf5=1-6,boost=1-54,xsd=3-1,cvode=2-7,parmetis=4&amp;machine=userpc59.cs.ox.ac.uk&amp;revision=23315&amp;runtime=0&amp;status=OK&amp;testsuite=global-test-TestChasteBuildInfo&amp;timestamp=1419722101.4278&amp;type=nightly which reports using HDF5 1.8.8.
</span><span class="nb">cd</span> ~/petsc-3.2-p7/
<span class="nb">export </span><span class="nv">PETSC_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu
./config/configure.py --download-f2cblaslapack<span class="o">=</span>1 --download-mpich<span class="o">=</span>1 --download-hdf5<span class="o">=</span>1 --download-parmetis<span class="o">=</span>1 --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared-libraries --with-fortran<span class="o">=</span>0 <span class="o">&amp;&amp;</span> ./config/builder.py
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu-opt
./config/configure.py --download-f2cblaslapack<span class="o">=</span>1 --download-mpich<span class="o">=</span>1 --download-hdf5<span class="o">=</span>1 --download-parmetis<span class="o">=</span>1 --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared-libraries --with-fortran<span class="o">=</span>0 --with-debugging<span class="o">=</span>0 <span class="o">&amp;&amp;</span> ./config/builder.py
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu-profile
./config/configure.py --download-f2cblaslapack<span class="o">=</span>1 --download-mpich<span class="o">=</span>1 --download-hdf5<span class="o">=</span>1 --download-parmetis<span class="o">=</span>1 --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared-libraries --with-fortran<span class="o">=</span>0 --CFLAGS<span class="o">=</span><span class="s2">"-fno-omit-frame-pointer -pg"</span> -CXXFLAGS<span class="o">=</span><span class="s2">"-fno-omit-frame-pointer -pg"</span> -LDFLAGS<span class="o">=</span>-pg <span class="o">&amp;&amp;</span> ./config/builder.py

<span class="c"># "ParMetis updated to 4.0.2 and split from Metis 5.0.2 which is now separate." on http://www.mcs.anl.gov/petsc/documentation/changes/33.html
# ParMETIS now requires METIS --download-parmetis=1
# METIS requires cmake
</span>
<span class="c"># As previous (3.2): this is dangerous!
</span><span class="nb">cd</span> ~/petsc-3.3-p5/
<span class="nb">export </span><span class="nv">PETSC_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu
./config/configure.py --download-f2cblaslapack<span class="o">=</span>1 --download-mpich<span class="o">=</span>1 --download-hdf5<span class="o">=</span>1 --download-parmetis<span class="o">=</span>1 --download-metis<span class="o">=</span>1 --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared-libraries --with-fortran<span class="o">=</span>0 <span class="o">&amp;&amp;</span> ./config/builder.py
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu-opt
./config/configure.py --download-f2cblaslapack<span class="o">=</span>1 --download-mpich<span class="o">=</span>1 --download-hdf5<span class="o">=</span>1 --download-parmetis<span class="o">=</span>1 --download-metis<span class="o">=</span>1 --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared-libraries --with-fortran<span class="o">=</span>0 --with-debugging<span class="o">=</span>0 <span class="o">&amp;&amp;</span> ./config/builder.py
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu-profile
./config/configure.py --download-f2cblaslapack<span class="o">=</span>1 --download-mpich<span class="o">=</span>1 --download-hdf5<span class="o">=</span>1 --download-parmetis<span class="o">=</span>1 --download-metis<span class="o">=</span>1 --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared-libraries --with-fortran<span class="o">=</span>0 --CFLAGS<span class="o">=</span><span class="s2">"-fno-omit-frame-pointer -pg"</span> -CXXFLAGS<span class="o">=</span><span class="s2">"-fno-omit-frame-pointer -pg"</span> -LDFLAGS<span class="o">=</span>-pg <span class="o">&amp;&amp;</span> ./config/builder.py

<span class="c"># As previous (3.2): this is dangerous!
</span><span class="nb">cd</span> ~/petsc-3.4.2/
<span class="nb">export </span><span class="nv">PETSC_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu
./config/configure.py --download-f2cblaslapack<span class="o">=</span>1 --download-mpich<span class="o">=</span>1 --download-hdf5<span class="o">=</span>1 --download-parmetis<span class="o">=</span>1 --download-metis<span class="o">=</span>1 --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared-libraries --with-fortran<span class="o">=</span>0 <span class="o">&amp;&amp;</span> ./config/builder.py
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu-opt
./config/configure.py --download-f2cblaslapack<span class="o">=</span>1 --download-mpich<span class="o">=</span>1 --download-hdf5<span class="o">=</span>1 --download-parmetis<span class="o">=</span>1 --download-metis<span class="o">=</span>1 --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared-libraries --with-fortran<span class="o">=</span>0 --with-debugging<span class="o">=</span>0 <span class="o">&amp;&amp;</span> ./config/builder.py
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu-profile
./config/configure.py --download-f2cblaslapack<span class="o">=</span>1 --download-mpich<span class="o">=</span>1 --download-hdf5<span class="o">=</span>1 --download-parmetis<span class="o">=</span>1 --download-metis<span class="o">=</span>1 --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared-libraries --with-fortran<span class="o">=</span>0 --CFLAGS<span class="o">=</span><span class="s2">"-fno-omit-frame-pointer -pg"</span> -CXXFLAGS<span class="o">=</span><span class="s2">"-fno-omit-frame-pointer -pg"</span> -LDFLAGS<span class="o">=</span>-pg <span class="o">&amp;&amp;</span> ./config/builder.py
<span class="c"># Extra build of optimised code (JMPF 7/7/2014)
</span><span class="nb">cd</span> ~/petsc-3.4.2/
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-intel-opt-mkl
<span class="nb">source</span> /opt/intel/bin/compilervars.sh intel64
./config/configure.py --with-cxx<span class="o">=</span>icpc --with-cc<span class="o">=</span>icc --with-vendor-compiler<span class="o">=</span>intel --download-mpich<span class="o">=</span>1 --download-hdf5<span class="o">=</span>1 --download-parmetis<span class="o">=</span>1 --download-metis<span class="o">=</span>1 --with-x<span class="o">=</span><span class="nb">false</span>  --with-debugging<span class="o">=</span>0 -PETSC_ARCH<span class="o">=</span>linux-intel-opt-mkl --with-clanguage<span class="o">=</span>cxx --with-blas-lapack-dir<span class="o">=</span>/opt/intel/composerxe/mkl/lib/intel64/ --with-fortran<span class="o">=</span>0 
make <span class="nv">PETSC_DIR</span><span class="o">=</span>/home/lofty/petsc-3.4.2 <span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-intel-opt-mkl all

<span class="nb">cd</span> ~/petsc-3.5.2/
<span class="nb">export </span><span class="nv">PETSC_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu
./config/configure.py --download-f2cblaslapack<span class="o">=</span>1 --download-mpich<span class="o">=</span>1 --download-hdf5<span class="o">=</span>1 --download-parmetis<span class="o">=</span>1 --download-metis<span class="o">=</span>1 --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared-libraries --with-fortran<span class="o">=</span>0 <span class="o">&amp;&amp;</span> make all
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu-opt
./config/configure.py --download-f2cblaslapack<span class="o">=</span>1 --download-mpich<span class="o">=</span>1 --download-hdf5<span class="o">=</span>1 --download-parmetis<span class="o">=</span>1 --download-metis<span class="o">=</span>1 --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared-libraries --with-fortran<span class="o">=</span>0 --with-debugging<span class="o">=</span>0 <span class="o">&amp;&amp;</span> make all
<span class="nb">export </span><span class="nv">PETSC_ARCH</span><span class="o">=</span>linux-gnu-profile
./config/configure.py --download-f2cblaslapack<span class="o">=</span>1 --download-mpich<span class="o">=</span>1 --download-hdf5<span class="o">=</span>1 --download-parmetis<span class="o">=</span>1 --download-metis<span class="o">=</span>1 --with-x<span class="o">=</span><span class="nb">false</span> --with-clanguage<span class="o">=</span>cxx --with-shared-libraries --with-fortran<span class="o">=</span>0 --CFLAGS<span class="o">=</span><span class="s2">"-fno-omit-frame-pointer -pg"</span> -CXXFLAGS<span class="o">=</span><span class="s2">"-fno-omit-frame-pointer -pg"</span> -LDFLAGS<span class="o">=</span>-pg <span class="o">&amp;&amp;</span> make all


<span class="c"># VTK; needs recent CMake to build!
</span><span class="nb">cd</span> ~/src/cmake-2.8.12.2/
./bootstrap --prefix<span class="o">=</span><span class="nv">$HOME</span>/cmake --parallel<span class="o">=</span>4 <span class="o">&amp;&amp;</span> make <span class="o">&amp;&amp;</span> make install
<span class="nb">cd</span> ~/bin
<span class="k">for </span>f in ~/cmake/bin/*; <span class="k">do </span>ln -s <span class="nv">$f</span>; <span class="k">done</span>
<span class="c"># Note cmake calls below rely on defaults VTK_BUILD_ALL_MODULES=OFF, BUILD_SHARED_LIBS=ON
# 5.10
</span>mkdir ~/src/vtk-build-5.10
<span class="nb">cd</span> ~/src/vtk-build-5.10
cmake -DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$HOME</span>/vtk-5.10 ../VTK5.10.1 <span class="o">&amp;&amp;</span> make -j4 <span class="o">&amp;&amp;</span> make install
<span class="c"># 6.0
</span>mkdir ~/src/vtk-build-6.0
<span class="nb">cd</span> ~/src/vtk-build-6.0
cmake -DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$HOME</span>/vtk-6.0 ../VTK6.0.0 <span class="o">&amp;&amp;</span> make -j4 <span class="o">&amp;&amp;</span> make install
<span class="c"># 6.1
</span>mkdir ~/src/vtk-build-6.1
<span class="nb">cd</span> ~/src/vtk-build-6.1
cmake -DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$HOME</span>/vtk-6.1 ../VTK-6.1.0 <span class="o">&amp;&amp;</span> make -j4 <span class="o">&amp;&amp;</span> make install

</pre></div><h2 id="Hostconfigconfiguration">Hostconfig configuration</h2>
<div class="code"><pre>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>

petsc_2_2_path <span class="o">=</span> <span class="s">'../../../petsc-2.2.1/'</span>
petsc_2_3_path <span class="o">=</span> <span class="s">'../../../petsc-2.3.2-p4/'</span>
petsc_3_0_path <span class="o">=</span> <span class="s">'../../../petsc-3.0.0-p12/'</span>
petsc_build_name <span class="o">=</span> <span class="s">'linux-gnu'</span>
petsc_build_name_profile <span class="o">=</span> <span class="s">'linux-gnu-profile'</span>
petsc_build_name_optimized <span class="o">=</span> <span class="s">'linux-gnu-opt'</span>
petsc_build_name_production <span class="o">=</span> <span class="s">'linux-intel-opt-mkl'</span>
parmetis_path <span class="o">=</span> <span class="s">'../../../ParMetis-3.1/'</span>

intel_path<span class="o">=</span><span class="s">'/opt/intel/composerxe'</span>
icpc <span class="o">=</span> <span class="s">'icpc'</span>

other_includepaths <span class="o">=</span> <span class="p">[</span><span class="s">'../../../xsd-3.2.0-x86_64-linux-gnu/libxsd'</span><span class="p">,</span>
                      <span class="s">'../../../hdf5/include'</span><span class="p">,</span>
                      parmetis_path<span class="p">]</span>

other_libpaths <span class="o">=</span> <span class="p">[</span>os<span class="o">.</span>path<span class="o">.</span>join<span class="p">(</span>petsc_2_3_path<span class="p">,</span> <span class="s">'externalpackages/f2cblaslapack/linux-gnu/'</span><span class="p">),</span>  
                  <span class="s">'../../../hdf5/lib'</span><span class="p">,</span>
                  parmetis_path<span class="p">]</span>

blas_lapack <span class="o">=</span> <span class="p">[</span><span class="s">'f2clapack'</span><span class="p">,</span> <span class="s">'f2cblas'</span><span class="p">]</span>
blas_lapack_production <span class="o">=</span> <span class="p">[</span><span class="s">'mkl_lapack'</span><span class="p">,</span> <span class="s">'mkl'</span><span class="p">,</span> <span class="s">'svml'</span><span class="p">]</span>
other_libraries <span class="o">=</span> <span class="p">[</span><span class="s">'boost_serialization'</span><span class="p">,</span> <span class="s">'boost_filesystem'</span><span class="p">,</span> <span class="s">'xerces-c'</span><span class="p">,</span> <span class="s">'hdf5'</span><span class="p">,</span> <span class="s">'z'</span><span class="p">,</span> <span class="s">'parmetis'</span><span class="p">,</span> <span class="s">'metis'</span><span class="p">]</span>

ccflags <span class="o">=</span> <span class="s">''</span>
ldflags <span class="o">=</span> <span class="s">''</span>

tools <span class="o">=</span> <span class="p">{</span><span class="s">'texttest'</span><span class="p">:</span> <span class="s">'../../../texttest-3.19/source/bin/texttest.py'</span><span class="p">,</span>
         <span class="s">'xsd'</span><span class="p">:</span> <span class="s">'../../../xsd-3.2.0-x86_64-linux-gnu/bin/xsd'</span><span class="p">,</span>
         <span class="s">'mpicxx'</span><span class="p">:</span> <span class="s">'mpicxx'</span><span class="p">,</span>
         <span class="s">'mpirun'</span><span class="p">:</span> <span class="s">'mpirun'</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">Configure</span><span class="p">(</span>prefs<span class="p">,</span> build<span class="p">):</span>
    <span class="sd">"""Allow the user to specify which version of various libraries we're using."""</span>
    <span class="c"># PETSc</span>
    <span class="k">global</span> petsc_path
    <span class="k">global</span> petsc_2_3_path
    external_packages <span class="o">=</span> <span class="s">'externalpackages'</span>
    <span class="c"># We default to PETSc 3 (see hostconfig.py) if present for this user</span>
    <span class="k">if</span> os<span class="o">.</span>path<span class="o">.</span>isdir<span class="p">(</span>petsc_3_0_path<span class="p">):</span>
        prefs<span class="p">[</span><span class="s">'petsc'</span><span class="p">]</span> <span class="o">=</span> prefs<span class="o">.</span>get<span class="p">(</span><span class="s">'petsc'</span><span class="p">,</span> <span class="s">'3.0'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        prefs<span class="p">[</span><span class="s">'petsc'</span><span class="p">]</span> <span class="o">=</span> prefs<span class="o">.</span>get<span class="p">(</span><span class="s">'petsc'</span><span class="p">,</span> <span class="s">'2.3'</span><span class="p">)</span>

    <span class="k">if</span> prefs<span class="p">[</span><span class="s">'petsc'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'3.4'</span><span class="p">:</span>
        petsc_path <span class="o">=</span> <span class="s">'/home/lofty/petsc-3.4.2'</span>
    <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'petsc'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'3.3'</span><span class="p">:</span>
        petsc_path <span class="o">=</span> <span class="s">'/home/lofty/petsc-3.3-p5'</span>
    <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'petsc'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'3.2'</span><span class="p">:</span>
        petsc_path <span class="o">=</span> <span class="s">'/home/lofty/petsc-3.2-p7'</span>
    <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'petsc'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'3.1'</span><span class="p">:</span>
        petsc_path <span class="o">=</span> <span class="s">'/home/lofty/petsc-3.1-p8'</span>
    <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'petsc'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'3.0'</span><span class="p">:</span>
        petsc_path <span class="o">=</span> petsc_3_0_path
    <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'petsc'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'2.3.3'</span><span class="p">:</span>
        petsc_2_3_path <span class="o">=</span> <span class="s">'/home/lofty/petsc-2.3.3-p15/'</span> <span class="c">#For testing SUBMINOR=3</span>
        petsc_path <span class="o">=</span> petsc_2_3_path
    <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'petsc'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'2.3'</span><span class="p">:</span>
        petsc_path <span class="o">=</span> petsc_2_3_path
    <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'petsc'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'2.2'</span><span class="p">:</span>
        petsc_path <span class="o">=</span> petsc_2_2_path
        external_packages <span class="o">=</span> <span class="s">'packages'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">'Unsupported PETSc version "</span><span class="si">%s</span><span class="s">" requested'</span> <span class="o">%</span> prefs<span class="p">[</span><span class="s">'petsc'</span><span class="p">])</span>
    <span class="k">if</span> build<span class="o">.</span>is_optimised<span class="p">:</span>
        build_name <span class="o">=</span> petsc_build_name_optimized
    <span class="k">else</span><span class="p">:</span>
        build_name <span class="o">=</span> petsc_build_name
    other_libpaths<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> os<span class="o">.</span>path<span class="o">.</span>join<span class="p">(</span>petsc_path<span class="p">,</span> external_packages<span class="p">,</span> <span class="s">'f2cblaslapack'</span><span class="p">,</span> build_name<span class="p">)</span>
    <span class="c"># Boost</span>
    prefs<span class="p">[</span><span class="s">'boost'</span><span class="p">]</span> <span class="o">=</span> prefs<span class="o">.</span>get<span class="p">(</span><span class="s">'boost'</span><span class="p">,</span> <span class="s">'1.40'</span><span class="p">)</span> <span class="c"># 1.40 is installed system-wide</span>
    <span class="k">for</span> ver <span class="ow">in</span> <span class="p">[</span><span class="s">'1.37'</span><span class="p">,</span> <span class="s">'1.42'</span><span class="p">,</span> <span class="s">'1.46.1'</span><span class="p">,</span> <span class="s">'1.48'</span><span class="p">,</span> <span class="s">'1.49'</span><span class="p">,</span> <span class="s">'1.51'</span><span class="p">,</span> <span class="s">'1.53'</span><span class="p">,</span> <span class="s">'1.54'</span><span class="p">,</span> <span class="s">'1.55'</span><span class="p">]:</span>
        <span class="k">if</span> prefs<span class="p">[</span><span class="s">'boost'</span><span class="p">]</span> <span class="o">==</span> ver<span class="p">:</span>
            AddBoost<span class="p">(</span><span class="s">'/home/lofty/boost_'</span> <span class="o">+</span> ver<span class="o">.</span>replace<span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="s">'_'</span><span class="p">),</span> prefs<span class="p">[</span><span class="s">'boost'</span><span class="p">])</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> prefs<span class="p">[</span><span class="s">'boost'</span><span class="p">]</span> <span class="o">!=</span> <span class="s">'1.40'</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">'Unsupported Boost version "</span><span class="si">%s</span><span class="s">" requested'</span> <span class="o">%</span> prefs<span class="p">[</span><span class="s">'boost'</span><span class="p">])</span>
    <span class="c"># HDF5</span>
    prefs<span class="p">[</span><span class="s">'hdf5'</span><span class="p">]</span> <span class="o">=</span> prefs<span class="o">.</span>get<span class="p">(</span><span class="s">'hdf5'</span><span class="p">,</span> <span class="s">'1.6'</span><span class="p">)</span>
    <span class="k">if</span> prefs<span class="p">[</span><span class="s">'hdf5'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'1.8'</span><span class="p">:</span>
        AddHdf5<span class="p">(</span><span class="s">'/home/lofty/hdf5_1_8_9/'</span><span class="p">)</span>
    <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'hdf5'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'1.6'</span><span class="p">:</span>
        AddHdf5<span class="p">(</span><span class="s">'../../../hdf5/'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">'Unsupported HDF5 version "</span><span class="si">%s</span><span class="s">" requested'</span> <span class="o">%</span> prefs<span class="p">[</span><span class="s">'hdf5'</span><span class="p">])</span>
    <span class="c"># Xerces</span>
    prefs<span class="p">[</span><span class="s">'xerces'</span><span class="p">]</span> <span class="o">=</span> prefs<span class="o">.</span>get<span class="p">(</span><span class="s">'xerces'</span><span class="p">,</span> <span class="s">'3.1'</span><span class="p">)</span>
    <span class="k">if</span> prefs<span class="p">[</span><span class="s">'xerces'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'2.8'</span><span class="p">:</span>
        AddXerces<span class="p">(</span><span class="s">'/home/lofty/xercesc_2_8'</span><span class="p">)</span>
    <span class="c"># XSD</span>
    prefs<span class="p">[</span><span class="s">'xsd'</span><span class="p">]</span> <span class="o">=</span> prefs<span class="o">.</span>get<span class="p">(</span><span class="s">'xsd'</span><span class="p">,</span> <span class="s">'3.2'</span><span class="p">)</span>
    <span class="k">if</span> prefs<span class="p">[</span><span class="s">'xsd'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'4.0'</span><span class="p">:</span>
        AddXsd<span class="p">(</span><span class="s">'../../../xsd-4.0.0-x86_64-linux-gnu'</span><span class="p">)</span>
    <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'xsd'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'3.3'</span><span class="p">:</span>
        AddXsd<span class="p">(</span><span class="s">'../../../xsd-3.3.0-x86_64-linux-gnu'</span><span class="p">)</span>
    <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'xsd'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'3.2'</span><span class="p">:</span>
        AddXsd<span class="p">(</span><span class="s">'../../../xsd-3.2.0-x86_64-linux-gnu'</span><span class="p">)</span>
    <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'xsd'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'3.1'</span><span class="p">:</span>
        AddXsd<span class="p">(</span><span class="s">'../../../xsd-3.1.0-x86_64-linux-gnu'</span><span class="p">)</span>
    <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'xsd'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'2.3'</span><span class="p">:</span>
        AddXsd<span class="p">(</span><span class="s">'../../../xsd-2.3.1-x86_64-linux-gnu'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">'Unsupported XSD version "</span><span class="si">%s</span><span class="s">" requested'</span> <span class="o">%</span> prefs<span class="p">[</span><span class="s">'xsd'</span><span class="p">])</span>
    <span class="c"># Parmetis.  We don't switch the libraries explicitly for this, since Parmetis 4 is obtained via PETSc 3.3.</span>
    <span class="c"># Instead we remove the version 3 includes if version 4 is requested.</span>
    <span class="k">if</span> <span class="s">'parmetis'</span> <span class="ow">in</span> prefs<span class="p">:</span>
        <span class="k">global</span> ccflags
        parmetis <span class="o">=</span> prefs<span class="p">[</span><span class="s">'parmetis'</span><span class="p">]</span>
        ccflags <span class="o">+=</span> <span class="s">' -DCHASTE_PARMETIS_REQUIRED='</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>parmetis<span class="p">)</span>
        petsc_ver <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> prefs<span class="p">[</span><span class="s">'petsc'</span><span class="p">]</span><span class="o">.</span>split<span class="p">(</span><span class="s">'.'</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">if</span> parmetis <span class="o">==</span> <span class="s">'3'</span> <span class="ow">and</span> petsc_ver <span class="o">&gt;=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">'You cannot use both ParMETIS 3 and PETSc &gt;= 3.3'</span><span class="p">)</span>
        <span class="k">if</span> parmetis <span class="o">==</span> <span class="s">'4'</span><span class="p">:</span>
            <span class="k">if</span> petsc_ver <span class="o">&lt;</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">'To use ParMETIS 4 you must install it using a recent PETSc (&gt;= 3.3)'</span><span class="p">)</span>
            RemoveFromPath<span class="p">(</span>other_includepaths<span class="p">,</span> parmetis_path<span class="p">)</span>
            RemoveFromPath<span class="p">(</span>other_libpaths<span class="p">,</span> parmetis_path<span class="p">)</span>
    <span class="c"># Optional libraries</span>
    <span class="k">global</span> use_cvode
    <span class="k">global</span> use_vtk
    <span class="k">global</span> use_adaptivity
    use_cvode <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>prefs<span class="o">.</span>get<span class="p">(</span><span class="s">'use-cvode'</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> use_cvode<span class="p">:</span>
        prefs<span class="p">[</span><span class="s">'cvode'</span><span class="p">]</span> <span class="o">=</span> prefs<span class="o">.</span>get<span class="p">(</span><span class="s">'cvode'</span><span class="p">,</span> <span class="s">'2.5'</span><span class="p">)</span>
        <span class="k">if</span> prefs<span class="p">[</span><span class="s">'cvode'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'2.5'</span><span class="p">:</span>
            cvode_path <span class="o">=</span> <span class="s">'../../../cvode'</span>
        <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'cvode'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'2.6'</span><span class="p">:</span>
            cvode_path <span class="o">=</span> <span class="s">'/home/lofty/cvode_2_6'</span>
        <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'cvode'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'2.7'</span><span class="p">:</span>
            cvode_path <span class="o">=</span> <span class="s">'/home/lofty/cvode_2_7'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">'Unsupported CVODE version "</span><span class="si">%s</span><span class="s">" requested'</span> <span class="o">%</span> prefs<span class="p">[</span><span class="s">'cvode'</span><span class="p">])</span>
        other_includepaths<span class="o">.</span>append<span class="p">(</span>os<span class="o">.</span>path<span class="o">.</span>join<span class="p">(</span>cvode_path<span class="p">,</span> <span class="s">'include'</span><span class="p">))</span>
        DetermineCvodeVersion<span class="p">(</span>other_includepaths<span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        other_libpaths<span class="o">.</span>append<span class="p">(</span>os<span class="o">.</span>path<span class="o">.</span>join<span class="p">(</span>cvode_path<span class="p">,</span> <span class="s">'lib'</span><span class="p">))</span>
        other_libraries<span class="o">.</span>extend<span class="p">([</span><span class="s">'sundials_cvode'</span><span class="p">,</span> <span class="s">'sundials_nvecserial'</span><span class="p">])</span>
    use_vtk <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>prefs<span class="o">.</span>get<span class="p">(</span><span class="s">'use-vtk'</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c"># VTK is required for adaptivity to work, so if vtk was explicitly</span>
    <span class="c"># turned off, turn off adaptivity too.</span>
    use_adaptivity <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>prefs<span class="o">.</span>get<span class="p">(</span><span class="s">'use-adaptivity'</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="ow">and</span> use_vtk
    <span class="c"># Todo #2367 - give a warning if adaptivity is requested, because it is no longer supported.</span>
    <span class="c"># This has to come after the 'if use_adaptivity' block, because the libraries there depend on these</span>
    <span class="k">if</span> use_vtk<span class="p">:</span>
        prefs<span class="p">[</span><span class="s">'vtk'</span><span class="p">]</span> <span class="o">=</span> prefs<span class="o">.</span>get<span class="p">(</span><span class="s">'vtk'</span><span class="p">,</span> <span class="s">'5'</span><span class="p">)</span>
        <span class="k">if</span> prefs<span class="p">[</span><span class="s">'vtk'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'6.1'</span><span class="p">:</span>
            other_includepaths<span class="o">.</span>append<span class="p">(</span><span class="s">'/home/lofty/vtk-6.1/include/vtk-6.1'</span><span class="p">)</span>
            other_libpaths<span class="o">.</span>append<span class="p">(</span><span class="s">'/home/lofty/vtk-6.1/lib'</span><span class="p">)</span>
            other_libraries<span class="o">.</span>extend<span class="p">([</span><span class="s">'vtkCommonCore-6.1'</span><span class="p">,</span><span class="s">'vtkCommonDataModel-6.1'</span><span class="p">,</span><span class="s">'vtkIOXML-6.1'</span><span class="p">,</span><span class="s">'vtkCommonExecutionModel-6.1'</span><span class="p">,</span><span class="s">'vtkFiltersCore-6.1'</span><span class="p">,</span><span class="s">'libvtkFiltersGeometry-6.1'</span><span class="p">])</span>
        <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'vtk'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'6.0'</span><span class="p">:</span>
            other_includepaths<span class="o">.</span>append<span class="p">(</span><span class="s">'/home/lofty/vtk-6.0/include/vtk-6.0'</span><span class="p">)</span>
            other_libpaths<span class="o">.</span>append<span class="p">(</span><span class="s">'/home/lofty/vtk-6.0/lib'</span><span class="p">)</span>
            other_libraries<span class="o">.</span>extend<span class="p">([</span><span class="s">'vtkCommonCore-6.0'</span><span class="p">,</span><span class="s">'vtkCommonDataModel-6.0'</span><span class="p">,</span><span class="s">'vtkIOXML-6.0'</span><span class="p">,</span><span class="s">'vtkCommonExecutionModel-6.0'</span><span class="p">,</span><span class="s">'vtkFiltersCore-6.0'</span><span class="p">,</span><span class="s">'libvtkFiltersGeometry-6.0'</span><span class="p">])</span>
        <span class="k">elif</span> prefs<span class="p">[</span><span class="s">'vtk'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'5.10'</span><span class="p">:</span>
            other_includepaths<span class="o">.</span>append<span class="p">(</span><span class="s">'/home/lofty/vtk-5.10/include/vtk-5.10'</span><span class="p">)</span>
            other_libpaths<span class="o">.</span>append<span class="p">(</span><span class="s">'/home/lofty/vtk-5.10/lib/vtk-5.10'</span><span class="p">)</span>
            other_libraries<span class="o">.</span>extend<span class="p">([</span><span class="s">'vtkGraphics'</span><span class="p">,</span><span class="s">'vtkFiltering'</span><span class="p">,</span><span class="s">'vtkIO'</span><span class="p">,</span><span class="s">'vtkCommon'</span><span class="p">,</span> <span class="s">'vtksys'</span><span class="p">,</span> <span class="s">'vtkexpat'</span><span class="p">,</span> <span class="s">'vtkzlib'</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            vtk_include_path <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span>os<span class="o">.</span>path<span class="o">.</span>isdir<span class="p">,</span> glob<span class="o">.</span>glob<span class="p">(</span><span class="s">'/usr/include/vtk-5*'</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span>vtk_include_path<span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">"No or multiple system headers for VTK 5 found"</span><span class="p">)</span>
            vtk_version <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>vtk_include_path<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span>split<span class="p">(</span><span class="s">'-'</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            other_includepaths<span class="o">.</span>append<span class="p">(</span>vtk_include_path<span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            other_libraries<span class="o">.</span>extend<span class="p">([</span><span class="s">'vtkIO'</span><span class="p">,</span><span class="s">'vtkGraphics'</span><span class="p">,</span><span class="s">'vtkCommon'</span><span class="p">,</span> <span class="s">'z'</span><span class="p">])</span>
            <span class="k">if</span> vtk_version <span class="o">&gt;=</span> <span class="mf">5.6</span><span class="p">:</span>
                other_libraries<span class="o">.</span>append<span class="p">(</span><span class="s">'vtkFiltering'</span><span class="p">)</span>
</pre></div></div>
          

    </div>
  </body>
</html>

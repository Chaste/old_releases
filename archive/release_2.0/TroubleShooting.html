<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
 <title>Chaste User Tutorial</title>
 <link rel="stylesheet" href="https://chaste.github.io/old_releases/trac.css" type="text/css" />
 <link rel="stylesheet" href="https://chaste.github.io/old_releases/wiki.css" type="text/css" />


 <style type="text/css">
/* Link styles */
:link, :visited, a em {
 text-decoration: none;
 color: #283f6b;
 border-bottom: 1px dotted #bbb;
}
/*
:link:hover, :visited:hover {
 background-color: #eee;
 color: #555;
}
*/
</style>

</head>
<body>
<a id="logo" href="https://chaste.github.io/">
  <img src="https://chaste.github.io/chaste_0256.png" alt="Chaste logo" height="60" />
</a>
<h1> TroubleShooting tutorial file </h1>      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          <p>
This pages stores a list of common problem and issues that occasionally crop up, together with their solutions. Please update problems and solutions if needed, and add new problems as they crop up.
</p>
<p>
<h4>Table of Contents</h4><ol><li><a href="#ChasteRunningTests">Chaste (Running Tests)</a><ol><li><a href="#Anexceptionoccursbuttheexceptionmessageisnotshown">An exception occurs but the exception message is not shown</a></li><li>
<a href="#Thedirectoryoutputwaswrittentoseemsempty">The directory output was written to seems empty</a></li><li>
<a href="#Strangeerroraboutsemgetandsetnum">Strange error about semget and setnum</a></li><li>
<a href="#Runninganalreadycompiledtestexecutablemanuallyinsteadofcompilingandrunningwithsconsfails">Running an already compiled test executable manually (instead of compiling …</a></li><li>
<a href="#AppeartogetincorrectanswerswhensolvingaPDE">Appear to get incorrect answers when solving a PDE</a></li></ol></li><li>
<a href="#Sconserrors">Scons errors</a><ol><li><a href="#NoSConstructfilefound">No SConstruct file found</a></li><li>
<a href="#IndexError:stringindexoutofrange">IndexError: string index out of range</a></li><li>
<a href="#Founddependencycycles">"Found dependency cycle(s)"</a></li></ol></li><li>
<a href="#Compilationandlinkingerrors">Compilation and linking errors</a><ol><li><a href="#Thecompilercomplainsthatavariablehasnotbeendefinedwhenitclearlyhasbeeninabaseclass">The compiler complains that a variable has not been defined when it …</a></li><li>
<a href="#GetamentalextremelylongsetofcompilationerrorsappearstobesomethingtodowithBoostmplorublas">Get a mental, extremely long, set of compilation errors, appears to be …</a></li><li>
<a href="#Undefinedreferenceerrorsonlinking">Undefined reference errors on linking</a></li><li>
<a href="#AcomparisonbetweensignedandunsignedintegerexpressionserrorpossiblyinafileintheCxxTestfolder">A "comparison between signed and unsigned integer expressions" error …</a></li><li>
<a href="#Error:voidYOUR_TEST_CLASS::YOUR_TEST_METHODisprivate">"Error: <tt>void &lt;YOUR_TEST_CLASS&gt;::&lt;YOUR_TEST_METHOD&gt;()</tt> is private"</a></li><li>
<a href="#Compilersaysc_vectororc_matrixwasnotdeclaredperhapsevenifyouareincludingboostnumericublasmatrix.hpp">Compiler says <tt>c_vector</tt> or <tt>c_matrix</tt> was not declared (perhaps even if …</a></li><li>
<a href="#GetaAssertionpetsc_is_initialisedfailederror">Get a "<tt>Assertion 'petsc_is_initialised' failed</tt>" error</a></li><li>
<a href="#Fatalerrorunknownerrorhandler.MaybeMPIcallbeforeMPI_INIT.ErrormessageisMPI_COMM_RANKandcodeis197">"Fatal error; unknown error handler. May be MPI call before MPI_INIT.  …</a></li><li>
<a href="#Boostserializationvector.hpp">Boost/serialization/vector.hpp</a></li><li>
<a href="#glibcdetectedfree:invalidpointer">glibc detected free(): invalid pointer</a></li><li>
<a href="#Invalidapplicationofsizeoftoincompletetypeboost::STATIC_ASSERTION_FAILUREfalse">Invalid application of 'sizeof' to incomplete type …</a></li></ol></li></ol>
</p>
<h1 id="ChasteRunningTests">Chaste (Running Tests)</h1>
<h2 id="Anexceptionoccursbuttheexceptionmessageisnotshown">An exception occurs but the exception message is not shown</h2>
<p>
Add <tt>throw (Exception)</tt> after the method declaration in the failing test, i.e.
</p>
<div class="code"><pre>    void TestSomething() throw (Exception)
    {
        // test
    }
</pre></div><h2 id="Thedirectoryoutputwaswrittentoseemsempty">The directory output was written to seems empty</h2>
<p>
If, in a terminal, you are in an output directory, and rerun a test that involves that directory being wiped and recreated, the terminal might act as if there's nothing in the directory, i.e. an <tt>ls</tt> displays no files. Just <tt>cd</tt> out and back into the directory again.
</p>
<h2 id="Strangeerroraboutsemgetandsetnum">Strange error about semget and setnum</h2>
<p>
<strong>Problem</strong>: <i>The following error message occurs when running a test</i>
</p>
<pre class="wiki">Running 9 testssemget failed for setnum =  0
</pre><p>
This happens occasionally. Rerun the test. If that fails run the MPI <tt>cleanipcs</tt> script, e.g. by doing:
</p>
<pre class="wiki">~/mpi/sbin/cleanipcs
</pre><h2 id="Runninganalreadycompiledtestexecutablemanuallyinsteadofcompilingandrunningwithsconsfails">Running an already compiled test executable manually (instead of compiling and running with scons) fails</h2>
<p>
Some environment variables are setup by the SCons scripts, you need to export them yourself.
</p>
<pre class="wiki">cdchaste
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:`pwd`/lib
./component/build/whatever/TestXRunner
</pre><p>
Also, if files are output to the current directory rather than <tt>/tmp/chaste/testoutput/</tt>, also do 
</p>
<pre class="wiki">export CHASTE_TEST_OUTPUT=/tmp/chaste/testoutput/
</pre><p>
(or <tt>/tmp/whatever/testoutput</tt>).
</p>
<h2 id="AppeartogetincorrectanswerswhensolvingaPDE">Appear to get incorrect answers when solving a PDE</h2>
<p>
If you try to solve a simple PDE with Neumann boundary conditions, with a known solution, but appear to get incorrect answers, you may have done one of two things incorrectly. For the elliptic PDE "du/dt = div (D grad_u) + f", where D is a matrix, the Neumann boundary condition that you specify (using <tt>BoundaryConditionsContainer</tt> and <a class="missing wiki" href="/cgi-bin/trac.cgi/wiki/ConstBoundaryConditions" rel="nofollow">ConstBoundaryConditions?</a>` etc) is the value of "(D grad_u) dot n" (where n is the unit <i>outward</i> facing normal), <strong>not</strong> the value of du/dn and not du/dx in 1D. In particular, in 1D, on the left-hand side n=-1 and you need to specify "-D du/dx", not just du/dx. See <a class="wiki" href="/cgi-bin/trac.cgi/wiki/UserTutorials/SolvingLinearPdes">UserTutorials/SolvingLinearPdes</a> for an example.
</p>
<h1 id="Sconserrors">Scons errors</h1>
<h2 id="NoSConstructfilefound">No SConstruct file found</h2>
<p>
The following error
</p>
<pre class="wiki">scons: *** No SConstruct file found.
File "/usr/lib/scons/SCons/Script/Main.py", line 825, in _main
</pre><p>
is, as it says, due to no <tt>SConstruct</tt> file found and probably because you are in the wrong directory - you should run scons from the main Chaste directory.
</p>
<h2 id="IndexError:stringindexoutofrange">IndexError: string index out of range</h2>
<p>
If you get the following error
</p>
<pre class="wiki">scons  test_suite=heart/test/bidomain/TestBidomainProblem.hpp 
IndexError: string index out of range:
  File "/usr/lib/scons/SCons/Script/Main.py", line 1171:
    _exec_main(parser, values)
  File "/usr/lib/scons/SCons/Script/Main.py", line 1144:
    _main(parser)
  File "/usr/lib/scons/SCons/Script/Main.py", line 880:
    if a[0] == '-':
</pre><p>
it could be because of the two spaces (!!!) between "<tt>scons</tt>" and "<tt>test_suite=</tt>" in "<tt>scons  test_suite=heart/test/bidomain/TestBidomainProblem.hpp</tt>" (only an issue if running scons through eclipse).
</p>
<h2 id="Founddependencycycles">"Found dependency cycle(s)"</h2>
<pre class="wiki">scons: done building targets.

scons: *** Found dependency cycle(s):
  Internal Error: no cycle found for node global/build/debug/src/Version.o (&lt;SCons.Node.FS.File instance at 0xdacc20&gt;) in state executed

File "/usr/lib64/python2.5/site-packages/SCons/Taskmaster.py", line 797, in cleanup
</pre><p>
If <tt>scons</tt> throws an error saying it has found a <i>dependency cycle</i> it probably has conflicting versions of things lying around and a clean build (<strong><tt>scons -c</tt></strong>) seems to sort it out.
</p>
<h1 id="Compilationandlinkingerrors">Compilation and linking errors</h1>
<h2 id="Thecompilercomplainsthatavariablehasnotbeendefinedwhenitclearlyhasbeeninabaseclass">The compiler complains that a variable has not been defined when it clearly has been, in a base class</h2>
<p>
If class <tt>A</tt> and class <tt>B</tt> are both templated, and <tt>B&lt;DIM&gt;</tt> inherits from <tt>A&lt;DIM&gt;</tt>, then the compiler won't be able to locate variables defined in the base class if used in the child unless the base is specified. The solution is to write <tt>this-&gt;</tt> before the variable in question. i.e.
</p>
<div class="code"><pre>template&lt;int DIM&gt;
class A
{
public:
  double x;
};
template&lt;int DIM&gt;
class B : public A&lt;DIM&gt;
{
  void run()
  {
    std::cout &lt;&lt; x;
  }
};
</pre></div><p>
won't compile, whereas
</p>
<div class="code"><pre>template&lt;int DIM&gt;
class A
{
public:
  double x;
};
template&lt;int DIM&gt;
class B : public A&lt;DIM&gt;
{
  void run()
  {
    std::cout &lt;&lt; this-&gt;x;
  }
};
</pre></div><p>
will do.  See <a class="wiki" href="/cgi-bin/trac.cgi/wiki/AccessingMemberVariablesInTemplatedSuperclasses">AccessingMemberVariablesInTemplatedSuperclasses</a>.
</p>
<h2 id="GetamentalextremelylongsetofcompilationerrorsappearstobesomethingtodowithBoostmplorublas">Get a mental, extremely long, set of compilation errors, appears to be something to do with Boost (mpl or ublas)</h2>
<p>
Try putting
</p>
<pre class="wiki">#include "UblasIncludes.hpp"
</pre><p>
as the <strong>first</strong> include in the source file being compiled (generally either a cpp file or the test being run).
</p>
<p>
It may be that the ublas include needs to come after any serialization include; I'm not sure.
</p>
<h2 id="Undefinedreferenceerrorsonlinking">Undefined reference errors on linking</h2>
<p>
<strong>Problem</strong>: <i>Undefined reference errors on linking, such as:</i>
</p>
<pre class="wiki">undefined reference to `Node&lt;1u&gt;::AddElement(unsigned int)'
</pre><p>
This may mean that you are using a templated class which has been written using <i>Explicit Instantiation</i>, and you are using a value for one of the template parameters for which there isn't an instantiation.  Not all classes are instantiated for all dimensions in order to reduce compilation time.  Look at the bottom of the cpp file for the class in question (e.g. Node.cpp in the example above) and check if there is a line like
</p>
<pre class="wiki">template class Node&lt;1&gt;;
</pre><p>
at the bottom of the file.  Add the missing dimension if not.
</p>
<p>
Note that for some classes (e.g. <tt>SimpleDg0ParabolicAssembler</tt>) the situation is more complex, since we don't just template over dimension.  In such cases there should be a file named like <tt>SimpleDg0ParabolicAssemblerImplementation.hpp</tt> which you can include, either in the hpp file (if you do not provide a cpp) or in your cpp file (and add further explicit instantiations there).  See <tt>MonodomainDg0Assembler.cpp</tt> for an example, and <a class="wiki" href="/cgi-bin/trac.cgi/wiki/StaticAndDynamicPolymorphism#Explicitinstantiation">StaticAndDynamicPolymorphism#Explicitinstantiation</a> for more info.
</p>
<h2 id="AcomparisonbetweensignedandunsignedintegerexpressionserrorpossiblyinafileintheCxxTestfolder">A "comparison between signed and unsigned integer expressions" error (possibly) in a file in the CxxTest folder</h2>
<p>
The following error (or actually, warning, which is then taken as an error)
</p>
<pre class="wiki">cxxtest/cxxtest/TestSuite.h: In function 'bool CxxTest::equals(X, Y) [with X = long unsigned int, Y = int]':
cxxtest/cxxtest/TestSuite.h:58:   instantiated from 'void CxxTest::doAssertEquals(const char*, unsigned int, const char*, X, const char*, Y, const char*) [with X = long unsigned int, Y = int]'
.&lt;FILE_NAME&gt;:&lt;LINE_NUMBER&gt;   instantiated from here
cxxtest/cxxtest/TestSuite.h:49: warning: comparison between signed and unsigned integer expressions
</pre><p>
is usually due to a comparison between an <tt>unsigned</tt> variable and a hardcoded number (taken as an <tt>int</tt> by the compiler) in a TS_ASSERT_EQUALS, for example
</p>
<pre class="wiki">unsigned my_var = 10;
TS_ASSERT_EQUALS(my_var, 10);
</pre><p>
To tell the compiler to treat the (second) 10 as an <tt>unsigned</tt>, do the following
</p>
<pre class="wiki">TS_ASSERT_EQUALS(my_var, 10u);
</pre><h2 id="Error:voidYOUR_TEST_CLASS::YOUR_TEST_METHODisprivate">"Error: <tt>void &lt;YOUR_TEST_CLASS&gt;::&lt;YOUR_TEST_METHOD&gt;()</tt> is private"</h2>
<p>
Remember all test methods need to be declared as <tt>public</tt>.
</p>
<h2 id="Compilersaysc_vectororc_matrixwasnotdeclaredperhapsevenifyouareincludingboostnumericublasmatrix.hpp">Compiler says <tt>c_vector</tt> or <tt>c_matrix</tt> was not declared (perhaps even if you are including &lt;boost/numeric/ublas/matrix.hpp&gt;)</h2>
<p>
These are ublas vectors and matrices. Do
</p>
<div class="code"><pre>#include "UblasIncludes.hpp"
</pre></div><p>
Note that it is not enough to do
</p>
<div class="code"><pre>#include &lt;boost/numeric/ublas/matrix.hpp&gt;
</pre></div><p>
as then you would have to write <tt>boost::numeric::ublas::c_matrix&lt;double,2,2&gt;</tt> instead of <tt>c_matrix&lt;double,2,2&gt;</tt>.
</p>
<h2 id="GetaAssertionpetsc_is_initialisedfailederror">Get a "<tt>Assertion 'petsc_is_initialised' failed</tt>" error</h2>
<p>
If the following is printed
</p>
<pre class="wiki">global/src/DistributedVector.cpp:47: static void DistributedVector::CheckForPetsc(): Assertion `petsc_is_initialised' failed.
</pre><p>
it is probably because you have forgotten to do
</p>
<div class="code"><pre>#include "PetscSetupAndFinalize.hpp"
</pre></div><p>
in your test.
</p>
<h2 id="Fatalerrorunknownerrorhandler.MaybeMPIcallbeforeMPI_INIT.ErrormessageisMPI_COMM_RANKandcodeis197">"Fatal error; unknown error handler. May be MPI call before MPI_INIT.  Error message is MPI_COMM_RANK and code is 197"</h2>
<p>
You may have included <tt>PetscSetupAndFinalize.hpp</tt> in a source file - it should only be included in test files (and must be included in all tests files that use PETSc).
</p>
<h2 id="Boostserializationvector.hpp">Boost/serialization/vector.hpp</h2>
<p>
(<a class="missing ticket">#1024</a>) If you see this:
</p>
<pre class="wiki">/usr/include/boost/serialization/vector.hpp:126: error: redefinition of 'struct boost::serialization::implementation_level&lt;std::vector&lt;long int, std::allocator&lt;long int&gt; &gt; &gt;'
/usr/include/boost/serialization/vector.hpp:126: error: previous definition of 'struct boost::serialization::implementation_level&lt;std::vector&lt;long int, std::allocator&lt;long int&gt; &gt; &gt;'
/usr/include/boost/serialization/vector.hpp:126: error: redefinition of 'struct boost::serialization::implementation_level&lt;std::vector&lt;long unsigned int, std::allocator&lt;long unsigned int&gt; &gt; &gt;'
/usr/include/boost/serialization/vector.hpp:126: error: previous definition of 'struct boost::serialization::implementation_level&lt;std::vector&lt;long unsigned int, std::allocator&lt;long unsigned int&gt; &gt; &gt;'
scons: building terminated because of errors.
</pre><p>
put 
</p>
<pre class="wiki">#include &lt;climits&gt;
</pre><p>
before
</p>
<pre class="wiki">#include "boost/serialization/vector.hpp"
</pre><h2 id="glibcdetectedfree:invalidpointer">glibc detected free(): invalid pointer</h2>
<p>
If you get an error starting something like:
</p>
<pre class="wiki">** glibc detected *** heart/build/debug/mechanics/TestCardiacElectroMechanicsProblemRunner: free(): invalid pointer: 0x00000000019ff758 ***
======= Backtrace: =========
/lib/libc.so.6[0x7f32485ae08a]
/lib/libc.so.6(cfree+0x8c)[0x7f32485b1c1c]
</pre><p>
then it may be because you haven't included a virtual destructor in the base class of your inheritance hierarchy, and you're deleting a derived class via a pointer of base class type. Another situation that may provoke this error is when you make use of <tt>CellwiseData</tt> but forget to call <tt>ReallocateMemory()</tt>.
</p>
<h2 id="Invalidapplicationofsizeoftoincompletetypeboost::STATIC_ASSERTION_FAILUREfalse">Invalid application of 'sizeof' to incomplete type 'boost::STATIC_ASSERTION_FAILURE&lt;false&gt;'</h2>
<p>
If you get this error
</p>
<pre class="wiki">/usr/include/boost/archive/detail/oserializer.hpp:566: error: invalid application of 'sizeof' to incomplete type 'boost::STATIC_ASSERTION_FAILURE&lt;false&gt;' 
</pre><p>
then you need to archive a <i>const</i> pointer to your object instead of just a pointer, e.g. instead of 
</p>
<pre class="wiki">Electrodes&lt;3&gt;* p_electrodes = new Electrodes&lt;3&gt;(mesh,false,1,0,10,magnitude,duration);
output_arch &lt;&lt; p_electrodes;
</pre><p>
put 
</p>
<pre class="wiki">Electrodes&lt;3&gt;* const p_electrodes = new Electrodes&lt;3&gt;(mesh,false,1,0,10,magnitude,duration);
output_arch &lt;&lt; p_electrodes;
</pre>
        
        
      </div>
